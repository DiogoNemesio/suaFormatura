<div id="content">
	<div class="page-header">
	<h1><i class="%IC%">&nbsp;</i>Cadastro de rifa
		<a id='a01ID' class='btn btn-white ' title="Voltar" href="javascript:zgLoadUrl('%URLVOLTAR%');"><i class="fa fa-arrow-left bigger-130"></i></a>
		<a id='a01ID' class='btn btn-white ' title="Novo Cadastro" href="javascript:zgLoadUrl('%URLNOVO%');"><i class="fa fa-file bigger-130"></i></a>
	</h1>
	</div><!-- /.page-header -->

	<div id="user-profile-3" class="user-profile row">
		<div class="col-sm-12">
			<form id="zgFormID" class="form-horizontal">
				<input type="hidden" name="id" value="%ID%">
				<input type="hidden" id="codRifaID" name="codRifa" value="%COD_RIFA%">
				<input type='hidden' name="numUsuAtivo" id='numUsuAtivoID' value="%NUM_USUARIO%">
				<div class="tabbable" id="tabID">
					<ul class="nav nav-tabs padding-16">
						<li class="active">
							<a data-toggle="tab" href="#parceiro-principal">
								<i class="green fa fa-edit bigger-125"></i>
								Principal
							</a>
						</li>
						<li>
							<a data-toggle="tab" href="#parceiro-endereco">
								<i class="black fa fa-search bigger-125"></i>
								Controle
							</a>
						</li>

					</ul>
					<div class="tab-content profile-edit-tab-content">
						<div id="parceiro-principal" class="tab-pane in active">
							<div class="vspace-xs"></div>
							<div class="row">
								<div class="col-sm-7">
									<h5 class="header blue bolder smaller">Informações da rifa</h5>
									<div class="form-group col-sm-12" id="divRifaEletronicaID">
								    	<label class="col-xs-12 col-sm-6 control-label" for="indRifaEletronicaID">Rifa eletrônica
								    		<span><i class="ace-icon fa fa-question-circle green" data-rel="popover" data-placement="left" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> O que é?" data-content="Na rifa eletrõnica os formandos irão realizar as vendas das rifas pelo portal e os compradores irão receber mensagem contento todas as informações da sua participação no sorteio. É a rifa ecologicamente correta, sem uso de papel!"></i></span>
								    	</label>
								    	<label>
								    		<input name="indRifaEletronica" %DISABLED% id="indRifaEletronicaID" class="ace ace-switch ace-switch-6" type="checkbox" onchange="mostraAviso();" %IND_RIFA_ELETRONICA% />
											<span class="lbl"></span>
										</label>
								    </div>
									<div class="form-group col-sm-12" id="divNomeID">
								    	<label class="col-sm-3 control-label" for="nomeID">Título</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe o título da rifa."></i></span>
							    			<input class="form-control" id="nomeID" %READONLY% type="text" name="nome" placeholder="Título da rifa" maxlength="100" value="%NOME%" onchange="atualizaResumo()" autocomplete="off">
								    	</div>
								    	<div class="col-sm-1 pull-left" id="divHelpNomeID"></div>
								    </div>
								    <div class="form-group col-sm-12" id="divPremioID">
								    	<label class="col-sm-3 control-label" for="premioID">Prêmio</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe o nome completo."></i></span>
							    			<input class="form-control" id="premioID" %READONLY% type="text" name="premio" placeholder="Prêmio" maxlength="100" value="%PREMIO%" onchange="atualizaResumo()" autocomplete="off">
								    	</div>
								    	<div class="col-sm-1 pull-left" id="divHelpPremioID"></div>
								    </div>
								    <div class="form-group col-sm-12" id="divCustoID">
								    	<label class="col-sm-3 control-label" for="custoID">Custo</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe o nome completo."></i></span>
							    			<input class="form-control" id="custoID" %READONLY% type="text" name="custo" placeholder="Custo do prêmio" maxlength="14" value="%CUSTO%" autocomplete="off" onchange="atualizaResumo()" zg-data-toggle="mask" zg-data-mask="dinheiro">
								    	</div>
								    	<div class="col-sm-1 pull-left" id="divHelpCustoID"></div>
								    </div>
								    <div class="form-group col-sm-12" id="divValorID">
						    			<label class="col-sm-3 control-label" for="valorID">Valor da rifa</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe um email para contato."></i></span>
						   					<input class="form-control" id="valorID" %READONLY% name="valor" placeholder="Valor unitário da rifa" maxlength="14" onchange="atualizaResumo()" value="%VALOR%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro">
						    			</div>
						    			<div class="col-sm-1 pull-left" id="divHelpEmailID"></div>
						    		</div>
						    		<div class="form-group col-sm-12" id="divQtdeObrigatorioID">
						    			<label class="col-sm-3 control-label" for="qtdeObrigatorioID">Qtde mínima</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe a quantidade mínima de rifas que cada formando terá que obrigatoriamente vender."></i></span>
						   					<input class="form-control" id="qtdeObrigatorioID" %READONLY% name="qtdeObrigatorio" placeholder="Quantidade mínima obrigatória" value="%QTDE_OBRIGATORIO%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="numero" onchange="atualizaResumo()">
						    			</div>
						    			<div class="col-sm-1 pull-left" id="divHelpQtdeObrigatorioID"></div>
						    		</div>
								    
								    <h5 class="header blue bolder smaller">Informações do sorteio</h5>
						    		<div class="form-group col-sm-12" id="divDataSorteioID">
								    	<label class="col-sm-3 control-label" for="dataSorteioID">Data/Hora</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe a data de nascimento do parceiro."></i></span>
							    			<input class="form-control datepicker" id="dataSorteioID" %READONLY% type="text" name="dataSorteio" maxlength="16" placeholder="Data do sorteio" value="%DATA_SORTEIO%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="datetimesimples">
								    	</div>
								    	<div class="col-sm-1 pull-left" id="divHelpDataSorteioID"></div>
								    </div>
								    <div class="form-group col-sm-12" id="divLocalSorteioID">
								    	<label class="col-sm-3 control-label" for="localSorteioID">Local</label>
						    			<div class="input-group col-sm-8 pull-left">
					    					<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe o nome completo."></i></span>
							    			<input class="form-control" id="localSorteioID" type="text" %READONLY% name="localSorteio" placeholder="Local do sorteio" maxlength="60" value="%LOCAL_SORTEIO%" autocomplete="off">
								    	</div>
								    	<div class="col-sm-1 pull-left" id="divHelpLocalSorteioID"></div>
								    </div>
								    
						    	</div>
						    
						    	<div class="col-sm-5">
									<div class="widget-box">
										<div class="widget-header widget-header-flat widget-header-small center">
											<h5 class="widget-title">Resumo</h5>
										</div>
										<div class="widget-body">
											<div class="widget-main small">
												
												<div class="row" id="divInfoNomeID">
													<h6 class="header blue bolder smaller">&nbsp;Informações da RIFA:</h6>
													<div class="vspace-xs"></div>
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Nome:</p>
												    	<p id='lbInfoIdentID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoPremioID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Prêmio:</p>
												    	<p id='lbInfoPremioID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoTurmaID">
													<h6 class="header blue bolder smaller">&nbsp;Informações da turma:</h6>
													<div class="vspace-xs"></div>
												</div>
												<div class="row" id="divInfoNumUsuID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Formandos ativos:</p>
												    	<p id='lbInfoNumUsuID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoConfID">
													<h6 class="header blue bolder smaller">&nbsp;Previsão financeira:</h6>
													<div class="vspace-xs"></div>
												</div>
												<div class="row" id="divInfoCustoID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Custo com prêmio (R$):</p>
												    	<p id='lbInfoCustoID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoValorID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor da RIFA (R$):</p>
												    	<p id='lbInfoValorID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoQtdeObrigatorioID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Qtde obrigatória:</p>
												    	<p id='lbInfoQtdeObrigatorioID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoQtdeObrigatorioID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor por formando (R$):</p>
												    	<p id='lbInfoValorObrigatorioID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row" id="divInfoCentroCustoID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;"><b>LUCRO (R$):</b></p>
												    	<p id='lbInfoLucroID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
												<div class="row hidden" id="divInfoPessoaID">
													<div class="col-sm-12">
												    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Fornecedor:</p>
												    	<p id='lbInfoPessoaID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
											    	</div>
												</div>
											</div>
										</div>
									</div>
								</div>			    	
						    </div>
						</div>
						
						<div id="parceiro-endereco" class="tab-pane">
							<div class="vspace-xs"></div>
							<div class="row">
								<div class="col-sm-12">
									<h5 class="header blue bolder smaller">Informações de controle</h5>
									<div class="form-group col-sm-7" id="divCepID">
										<label for="cepID" class="col-sm-3 control-label">Cadastrado por:</label>
										<div class="input-group col-sm-8 pull-left">											
											<input type="text" value="%USUARIO_CADASTRO%" readonly maxlength="100" class="width-100" placeholder="Cadastrado por" autocomplete="off" />
										</div>
										<div class="col-sm-1 pull-left" id="divHelpCepID"></div>
									</div>
									<div class="form-group col-sm-7" id="divCepID">
										<label for="cepID" class="col-sm-3 control-label">Data do cadastro:</label>
										<div class="input-group col-sm-8 pull-left">
											<input type="text" value="%DATA_CADASTRO%" readonly maxlength="100" class="width-100" placeholder="Data do cadastro" autocomplete="off" />
										</div>
										<div class="col-sm-1 pull-left" id="divHelpCepID"></div>
									</div>
									
									<div class="form-group col-sm-7" id="divCepID">
										<label for="cepID" class="col-sm-3 control-label">Alterado por:</label>
										<div class="input-group col-sm-8 pull-left">
											<input type="text" value="%USUARIO_ALTERACAO%" readonly maxlength="100" class="width-100" placeholder="Alterado por" autocomplete="off" />
										</div>
										<div class="col-sm-1 pull-left" id="divHelpCepID"></div>
									</div>
									<div class="form-group col-sm-7" id="divCepID">
										<label for="cepID" class="col-sm-3 control-label">Data da alteração:</label>
										<div class="input-group col-sm-8 pull-left">
											<input type="text" value="%DATA_ALTERACAO%" readonly maxlength="100" class="width-100" placeholder="Data da última alteracao" autocomplete="off" />
										</div>
										<div class="col-sm-1 pull-left" id="divHelpCepID"></div>
									</div>
																												
								</div>
							</div>
						</div>

					</div>
				</div>
				<div class="clearfix form-actions">
					<label class="col-sm-5 control-label">&nbsp;</label>
					<button type="button" class="btn btn-primary" id="btnSubmitID">
						<i class="fa fa-check bigger-110"></i> Salvar
					</button>
					<button type="button" class="btn btn-warning" id="cancel"
						onclick="javascript:zgLoadUrl('%URLVOLTAR%');">
						<i class="fa fa-undo bigger-110"></i> Voltar
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript" charset="%CHARSET%">

/*********************************************************
* Inicializações 
*********************************************************/
//Popover
$('[data-rel=popover]').popover({html:true});
//Máscaras
$('[zg-data-toggle="mask"]').each(function( index ) {
	zgMask($( this ), $( this ).attr('zg-data-mask'));
});

// Datetime picker
$('#dataSorteioID').datetimepicker({
	format: 'DD/MM/YYYY HH:mm',
    language: 'pt-BR'	
}).next().on(ace.click_event, function(){
	 
});

//Atualizar MENU
atualizaResumo();


/******************************************************
SUBMIT FORMULARIO
/******************************************************/
$('#btnSubmitID').on("click", function(e) {
	
	var vOK 	= validaRifaAlt();
	
	if(vOK == false) 	{
		$.gritter.add({
			title: 'Está faltando alguma coisa !!!',
			text: 'Corrija os campos marcados em vermelho',
			class_name: 'gritter-info gritter-error',
			time: '5000'
		});
		e.preventDefault();
		
		return false;
	}else{;
		$('#zgFormID').submit();
	}
});

//Submit formulário
$('#zgFormID').submit(function() {
	
	/** Retira a máscara para os campos que estão configurados para tal **/
	$('[zg-data-mask-retira="1"]').each(function( index ) {
		$( this ).val($( this ).cleanVal());
	});
	
	/** Habilitar os SELECTS que estão desabilitados para poder enviar o valor **/
	$( "select" ).each(function( index ) {
		if ($(this).hasClass('readonly')) {
			$(this).prop( "disabled", false );
		}
	});
	
	$.ajax({
		type:	"POST", 
		url:	"%DP%",
		data:	$('#zgFormID').serialize(),
	}).done(function( data, textStatus, jqXHR) {
		if (checaRetornoOK(data) == true) {
			$('#codRifaID').val(zgGetCodRetorno(data));
			zgMostraAviso("Fechar",'Nova Rifa', '%URLNOVO%');
		}else{
			zgMostraAviso("Fechar");
		}
		
		$('#zgDivModalID').on('hidden.bs.modal', function () {
			zgLimpaModalAviso();
			$('#zgDivModalID').off('hidden.bs.modal');
		});
		
		/** Desabilitar os SELECTS **/
		$( "select" ).each(function( index ) {
			if ($(this).hasClass('readonly')) {
				$(this).prop( "disabled", true );
			}
		});
		
		/** Recolocar a máscara para os campos que estão configurados para tal **/
		$('[zg-data-mask-retira="1"]').each(function( index ) {
			zgMask($( this ), $( this ).attr('zg-data-mask'));
			$( this ).trigger('keyup');
		});
		
	}).fail(function( jqXHR, textStatus, errorThrown) {
		zgMostraAviso(null);
	});
	return false; 
});


/******************************************************
VALIDA FORMULÁRIO
/******************************************************/
function validaRifaAlt() {
	var vNome			= $('#nomeID').val();
	var vPremio	    	= $('#premioID').val();
	var vCusto			= $('#custoID').val();
	var vDataSorteio	= $('#dataSorteioID').val();
	var vLocalSorteio	= $('#localSorteioID').val();
	var vQtdeObrigatorio = $('#qtdeObrigatorioID').val();
	var vValor			= $('#valorID').val();
	
	var vOK				= true;
	var vIdent;
	var vTab			= 0;
	
	//---- ABA PRINCIPAL ----/
		
	/** NOME **/
	if (!vNome){
		$('#divNomeID').addClass('has-error');
		$('#divHelpNomeID').html(zgCriaSpanErro('O nome da rifa deve ser preenchido!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divNomeID').removeClass('has-error');
		$('#divHelpNomeID').html('&nbsp;');		
	}
	
	/** PREMIO **/
	if (!vPremio){
		$('#divPremioID').addClass('has-error');
		$('#divHelpPremioID').html(zgCriaSpanErro('O prêmio da rifa deve ser preenchido!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divPremioID').removeClass('has-error');
		$('#divHelpPremioID').html('&nbsp;');		
	}
	
	/** DATA SORTEIO **/
	if (!vDataSorteio){
		$('#divDataSorteioID').addClass('has-error');
		$('#divHelpDataSorteioID').html(zgCriaSpanErro('A data do sorteio deve ser preenchida!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divDataSorteioID').removeClass('has-error');
		$('#divHelpDataSorteioID').html('&nbsp;');		
	}
	
	/** LOCAL SORTEIO **/
	if (!vDataSorteio){
		$('#divLocalSorteioID').addClass('has-error');
		$('#divHelpLocalSorteioID').html(zgCriaSpanErro('A data do sorteio deve ser preenchida!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divLocalSorteioID').removeClass('has-error');
		$('#divHelpLocalSorteioID').html('&nbsp;');		
	}
	
	/** QTDE OBRIGATORIO **/
	if (!vQtdeObrigatorio){
		$('#divQtdeObrigatorioID').addClass('has-error');
		$('#divHelpQtdeObrigatorioID').html(zgCriaSpanErro('A quantidade mínida de rifas a serem vendida por formando deve ser preenchida!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divQtdeObrigatorioID').removeClass('has-error');
		$('#divHelpQtdeObrigatorioID').html('&nbsp;');		
	}
	
	/** VALOR **/
	if (!vValor){
		$('#divValorID').addClass('has-error');
		$('#divHelpValorID').html(zgCriaSpanErro('O valor uniário da rifa deve ser preenchido!'));
		vOK		= false;
		vTab 	= 0;
	}else{
		$('#divValorID').removeClass('has-error');
		$('#divHelpValorID').html('&nbsp;');		
	}
	
	
	
	if (vOK == true) {
		return true ;
	}else{
		//Abrir aba que tiver campos inválidos
		$('#tabID li:eq('+ vTab +') a').tab('show');
		//Rolar pagina para o topo
		$('html, body').animate({scrollTop:0}, 'slow');
		return false;
	}
}

	
function atualizaResumo() {
	var $nome		= $('#nomeID').val();
	var $premio		= $('#premioID').val();
	var $custo		= $('#custoID').val();
	var $valor		= $('#valorID').val();
	var $numUsu		= $('#numUsuAtivoID').val();
	var $qtdeObri	= $('#qtdeObrigatorioID').val();
	
	$('#lbInfoIdentID').text($nome);
	$('#lbInfoPremioID').text($premio);
	$('#lbInfoCustoID').text($custo);
	$('#lbInfoValorID').text($valor);
	$('#lbInfoNumUsuID').text($numUsu);
	$('#lbInfoQtdeObrigatorioID').text($qtdeObri);
	
	// CALCULOS
	var options = {
			symbol : "",
			decimal : ",",
			thousand: ".",
			precision : 2,
			format: "%s%v"
		};
	
	
	$nValor		= parseFloat($('#valorID').val().replace(".", "").replace(",","."));
	$nCusto		= parseFloat($('#custoID').val().replace(".", "").replace(",","."));
	
	if (isNaN($nCusto))		$nCusto		= 0;
	
	// CUSTO POR FORMANDO E LUCRO
	if ($nValor && $qtdeObri){
		//CUSTO POR FORMANDO
		$valorObri = $nValor * $qtdeObri;
		$valorObri = accounting.formatMoney($valorObri, options);
		
		$('#lbInfoValorObrigatorioID').text($valorObri);
		
		//LUCRO
		$nLucro = $nValor * $qtdeObri * $numUsu - $nCusto;
		//$lucro = accounting.formatMoney($nlucro, options);
		
		if ($nLucro > 0) {
			$desc	= "<span class='text-success'>"+accounting.formatMoney($nLucro, options)+"</span>";
		}else{
			$desc	= "<strong>&nbsp;<span class='text-danger'>"+accounting.formatMoney($nLucro, options)+"</span>&nbsp;</strong>";
		}
		
		$('#lbInfoLucroID').html($desc);
	}
	
}

/******************************************************
MOSTRAR MODAL CASO SEJA DESMARCADO O RIFA ELETRÔNICA
/******************************************************/
function mostraAviso() {
	var vRifaEletronica	= $('#indRifaEletronicaID').is(':checked');
	
	if (vRifaEletronica == false) {
		zgAbreModal("%ROOT_URL%/Fmt/rifaAltAviso.php");

	}
}
	
</script>
