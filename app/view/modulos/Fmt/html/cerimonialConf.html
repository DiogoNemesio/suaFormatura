<form id="zgFormModalID" class="form-horizontal">
<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	<h4 class=""><i class="fa fa-cog blue"></i>&nbsp;%TITULO%</h4>
</div>
<div class="modal-body" style="overflow-y: scroll; height: 320px;">
	<input type="hidden" name="codOrganizacao" value="%COD_ORGANIZACAO%">
	<input type="hidden" id="codFormaDescontoID" name="codFormaDesconto" value="%COD_FORMA_DESC%">
	<input type="hidden" name="id" value="%ID%">
	<div class="row">
		<div class="col-sm-12 form-group">
			<label class="col-sm-4 control-label" for="codPlanoID">Plano para as formaturas</label>
   			<div class="input-group col-sm-5 pull-left">
   				<span tabindex="99001" class="input-group-addon" data-toggle="popover" data-trigger="hover" data-placement="top" data-content="Selecione o plano que as formaturas deste cerimonial irão ter"><i class="fa fa-question-circle"></i></span>
				<select class="select2" style="width:100%;" id="codPlanoID" placeholder="Selecione o plano para as formaturas" name="codPlano" data-rel="select2">
				%PLANOS%
				</select>
			</div>
    	</div>
    	<div class="col-sm-12">
			<h5 class="header blue bolder smaller">Desconto</h5>
			<div class="form-group col-sm-12" id="divFormaDescontoID">
				<label class="col-sm-3 control-label">Forma de Desconto: </label>
				<div class="btn-group btn-corner col-sm-8 pull-left">
					<span id='codFormaDescontoVID' style="width: 180px;" class="btn btn-sm" onclick="selecionaFormaDescontoValorFmtAlt();">Por Valor</span>
					<span tabindex="99001" class="btn btn-sm btn-info"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe a forma que deseja dar o desconto"></i></span>
					<span id='codFormaDescontoPID' style="width: 180px;" class="btn btn-sm" onclick="selecionaFormaDescontoPctFmtAlt();">Porcentagem</span>
				</div>
			</div>
				
			<div class="form-group col-sm-12" id="divValorDescontoID">
				<label class="col-sm-3 control-label" for="valorDescontoID">Valor do desconto</label>
  					<div class="input-group col-sm-4 pull-left">
	  					<span tabindex="99008" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Valor do Desconto no contrato"></i></span>
	   					<input class="form-control" id="valorDescontoID" type="text" name="valorDesconto" maxlength="20" value="%VALOR_DESCONTO%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0">
	    			</div>
				<div class="help-block col-sm-5 inline" id="divHelpValorDescontoID"></div>
   			</div>
			<div class="form-group col-sm-12" id="divPctDescontoID">
				<label class="col-sm-3 control-label" for="pctDescontoID">% de desconto</label>
  					<div class="input-group col-sm-4 pull-left">
  						<span tabindex="99008" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Percentual de desconto no contrato"></i></span>
   						<input class="form-control" id="pctDescontoID" type="text" name="pctDesconto" maxlength="20" value="%PCT_DESCONTO%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="porcentagem" zg-data-mask-retira="1">
	    		</div>
				<div class="help-block col-sm-5 inline" id="divHelpPctDescontoID"></div>
   			</div>
		</div>
	</div>		    
    <div id="divMsgCerConfID">
    </div>
</div>
<div class="modal-footer">
	<button type="submit" class="btn btn-primary" id="btnSubmitID">Salvar</button>
	<button type="button" data-dismiss="modal" id="cancel" class="btn">Fechar</button>
</div>
</form>


<script type="text/javascript" charset="%CHARSET%">
// Desabilitar os selects para a tela de View **/
$('[data-rel="select2"]').each(function( index ) {
	$(this).select2({allowClear: true});
	if ($(this).hasClass('readonly')) {
		$(this).select2("readonly", true);
	}
});

//Mensagens
$('[data-rel=tooltip]').tooltip();
$('[data-rel=popover]').popover({html:true});

/**Verifica a forma de desconto do contrato **/
var vFormaDesc 		= $('#codFormaDescontoID').val();
if (vFormaDesc == "V") {
	selecionaFormaDescontoValorFmtAlt();
}else{
	selecionaFormaDescontoPctFmtAlt();
}

//Mascaras
$('[zg-data-toggle="mask"]').each(function( index ) {
	zgMask($( this ), $( this ).attr('zg-data-mask'));
});


$('#zgFormModalID').submit(function() {
	
	$('#btnSubmitID').html('Aguarde...  <i class="ace-icon fa fa-spinner fa-spin orange bigger-125"></i>');
	$('#btnSubmitID').attr("disabled","disabled");
	$('#cancel').attr("disabled","disabled");

	$.ajax({
		type:	"POST", 
		url:	"%DP_MODAL%",
		data:	$('#zgFormModalID').serialize(),
	}).done(function( data, textStatus, jqXHR) {
		if (checaRetornoOK(data) == true) {
			zgMostraMsg('divMsgCerConfID',zgGetMsgRetorno(data));
		}else{
			zgMostraErro('divMsgCerConfID',zgGetMsgRetorno(data));
		}

		//Voltar o botão de salvar
		$('#btnSubmitID').html('Salvar ');
		$('#btnSubmitID').attr("disabled",false);
		$('#cancel').attr("disabled",false);
		
		$('#zgDivModalID').on('hidden.bs.modal', function () {
			zgLoadUrl('%URL_VOLTAR%');
			$('#zgDivModalID').off('hidden.bs.modal');
		});

		
	}).fail(function( jqXHR, textStatus, errorThrown) {
		zgMostraErro('zgDivModalID',errorThrown);
	});
	return false; 
});

/** Desconto **/

function selecionaFormaDescontoValorFmtAlt() {
	$('#codFormaDescontoVID').addClass("btn-primary");
	$('#codFormaDescontoVID').removeClass("btn-light");
	$('#codFormaDescontoPID').addClass("btn-light");
	$('#codFormaDescontoPID').removeClass("btn-primary");
	$('#pctDescontoID').val('');
	$('#codFormaDescontoID').val("V");
	mostraDivFormaDescontoFmtAlt();
}

function selecionaFormaDescontoPctFmtAlt() {
	$('#codFormaDescontoPID').addClass("btn-primary");
	$('#codFormaDescontoPID').removeClass("btn-light");
	$('#codFormaDescontoVID').addClass("btn-light");
	$('#codFormaDescontoVID').removeClass("btn-primary");
	$('#valorDescontoID').val('');
	$('#codFormaDescontoID').val("P");
	mostraDivFormaDescontoFmtAlt();
}

function mostraDivFormaDescontoFmtAlt() {
	var vFormaDesc 		= $('#codFormaDescontoID').val();
	
	if (vFormaDesc 	== 'V') {
		$('#divPctDescontoID').hide();
		$('#divValorDescontoID').show();
	}else{
		$('#divValorDescontoID').hide();
		$('#divPctDescontoID').show();
	}
}

</script>
