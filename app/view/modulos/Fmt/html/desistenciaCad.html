<div id="content">
	<div class="page-header">
	<h1>Desistência</h1>
	</div><!-- /.page-header -->
	<br />

	<!-- #section:plugins/fuelux.wizard -->
	<div id="fuelux-wizard-container" class="col-sm-10 pull-left">
		<div>
			<!-- #section:plugins/fuelux.wizard.steps -->
			<ul class="steps">
				<li data-step="1" class="active">
					<span class="step">1</span>
					<span class="title">Eventos</span>
				</li>
				<li data-step="2">
					<span class="step">2</span>
					<span class="title">Multa / Vencimento</span>
				</li>
				<li data-step="3">
					<span class="step">3</span>
					<span class="title">Valores</span>
				</li>
				<li data-step="4">
					<span class="step">4</span>
					<span class="title">Parcelas</span>
				</li>
			</ul>
		</div>
		<hr />
		<form id="zgFormDesCadID" class="form-horizontal">
			<input type="hidden" name="id" value="%ID%">
			<input type="hidden" name="codFormando" id="codFormandoID">
			<input type="hidden" id="valTotalMensalidadeID" value="%TOTAL_MENSALIDADE%">
			<input type="hidden" id="valPagoMensalidadeID" value="%PAGO_MENSALIDADE%">
			<input type="hidden" name="valPagoPortal" id="valPagoPortalID" value="%PAGO_SISTEMA%">
			<input type="hidden" name="valTotalSistema" id="valTotalSistemaID" value="%TOTAL_SISTEMA%">
			<input type="hidden" name="valDevidoSistema" id="valDevidoSistemaID" value="%DEVIDO_SISTEMA%">
			<input type="hidden" name="taxaBol" id="taxaBolID">
			<input type="hidden" name="taxaAdmin" id="taxaAdminID" value="%TAXA_ADMIN%">
			<input type="hidden" name="saldoSistema" id="saldoSistemaID">
			<input type="hidden" name="saldoMensalidade" id="saldoMensalidadeID">
			<input type="hidden" name="saldoMulta" id="saldoMultaID">
			<input type="hidden" id="numEventosID" value="%NUM_EVENTOS%">
			<input type="hidden" id="numMesesMaxID" value="%NUM_MESES_MAX%">
			<input type="hidden" name="valTotalEventos" id="valTotalEventosID">
			
			<input type="hidden" name="valParcelaMensalidade" id="valParcelaMensalidadeID">
			<input type="hidden" name="valParcelaSistema" id="valParcelaSistemaID">
			<input type="hidden" name="valParcelaTaxa" id="valParcelaTaxaID">
			<input type="hidden" name="_valTotalMensalidade" id="_valTotalMensalidadeID">
			<input type="hidden" name="_valTotalSistema" id="_valTotalSistemaID">
			<input type="hidden" name="_valTotalTaxa" id="_valTotalTaxaID">
			<input type="hidden" name="totalParcela" id="totalParcelaID">
			<input type="hidden" name="totalGeral" id="totalGeralID">
			<input type="hidden" name="codTipoConta" id="codTipoContaID">
			
			<div class="step-content pos-rel col-xs-12 pull-left">
				<div class="step-pane" data-step="1">
					<div class="col-sm-8 pull-left">
						<div class="row">
							<div class="col-xs-12 col-sm-12">
								<div class="control-group">
										%HTML_EVENTOS%
								</div>
							</div>
						</div>
					</div>
					
					<div class="col-sm-4 pull-right" id="divInfoDesCadStep1ID">
						<div class="hidden-480">
							<div class="widget-box">
								<div class="widget-header widget-header-flat widget-header-small center">
									<h5 class="widget-title">Informações</h5>
								</div>
								<div class="widget-body">
									<div class="widget-main small">
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor da formatura:</p>
										    	<p id='lbInfoValorFormaturaStep1ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>	
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Total dos eventos:</p>
										    	<p id='lbInfoTotalEventosStep1ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Pagamentos realizados:</h6>
										</div>					
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Mensalidades:</p>
										    	<p id='lbInfoSaldoMensalidadeStep1ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
										    	<p id='lbInfoSaldoPortalStep1ID' class="col-sm-7 pull-left align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
									</div>
								</div>
							</div>
						</div>	
					</div>
				</div>
				<div class="step-pane active" data-step="2">
					<div class="col-sm-8 pull-left">
						<div class="row ">
							<div class="form-group col-sm-12" id="divCodTipoBaseCalculoID">
								<label class="col-sm-5 control-label">Calcular por:</label>
								<div class="input-group col-sm-6">
									<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Selecione a base de calculo da multa"></i></span>
									<select class="select2 readonly" onchange="alteraBaseCalculoDesCad();" style="width:100%;" id="codTipoBaseCalculoID" name="codTipoBaseCalculo" data-rel="select2">
									%BASES_CALCULO%
									</select>
								</div>
							</div>
							<div class="form-group col-sm-12" id="divValorID">
							    <label class="col-sm-5 control-label">% de multa</label>
					    		<div class="input-group col-sm-6 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe um valor que será acrescido as mensalidades do formando, esse valor não é obrigatório"></i></span>
						    		<input class="form-control" id="pctMultaID" type="text" name="pctMulta" maxlength="7" value="" onchange="alteraPctMultaDesCad();" placeholder="Pct de Multa" autocomplete="off" zg-data-toggle="mask" zg-data-mask="porcentagem">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpPctMultaID"></div>
							</div>		
							<div class="form-group col-sm-12" id="divDataVencID">
							    <label for="identID" class="col-sm-5 control-label">Vencimento da 1&ordf; Parcela</label>
					    		<div class="input-group col-sm-6 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe a data de vencimento da primeira mensalidade, as próximas mensalidades vão ser geradas no mesmo dia do mês subsequente."></i></span>
				    				<input class="form-control datepicker" id="dataVencID" type="text" name="dataVenc" maxlength="10" value="%DATA_VENC%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="data">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpDataVencID"></div>
							</div>
							<div class="form-group col-sm-12" id="divNumMesesID">
							    <label for="identID" class="col-sm-5 control-label">Número de Parcelas</label>
					    		<div class="input-group col-sm-6 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Número de Mensalidades a serem geradas"></i></span>
									<input class="form-control" id="numMesesID" type="text" name="numMeses" maxlength="3" value="%NUM_MESES_MAX%" placeholder="Valor por Formando" max="%NUM_MESES_MAX%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="numero">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpNumMesesID"></div>
							</div>
						</div>
					</div>
					
					<div class="col-sm-4 pull-right" id="divInfoStep2ID">
						<div class="hidden-480">
							<div class="widget-box">
								<div class="widget-header widget-header-flat widget-header-small center">
									<h5 class="widget-title">Informações</h5>
								</div>
								<div class="widget-body">
									<div class="widget-main small">
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor da formatura:</p>
										    	<p id='lbInfoValorFormaturaStep2ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>	
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Total dos eventos:</p>
										    	<p id='lbInfoTotalEventosStep2ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Pagamentos realizados:</h6>
										</div>					
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Mensalidades:</p>
										    	<p id='lbInfoSaldoMensalidadeStep2ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
										    	<p id='lbInfoSaldoPortalStep2ID' class="col-sm-7 pull-left align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Valores devidos:</h6>
										</div>					
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Multa:</p>
										    	<p id='lbInfoValDevidoMultaStep2ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row" >
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
										    	<p id='lbInfoValDevidoPortalStep2ID' class="col-sm-7 pull-left align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Saldo:</h6>
										</div>
										<div class="row">
											<div class="col-sm-12">
										    	<h5 id='lbInfoSaldoTituloStep2ID' class="col-sm-5 pull-left align-right inline" style="padding: 2px; margin:0;"></h5>
										    	<p id='lbInfoSaldoStep2ID' class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;"><b></b></p>
									    	</div>
										</div>
									</div>
								</div>
							</div>
						</div>	
					</div>
				</div>
				<div class="step-pane" data-step="3">
					<div class="col-sm-8 pull-left">
						<div class="row">
							<div class="form-group col-sm-12 hidden" id="divValorID">
							    <label id='lblTipoValorID' class="col-sm-4 control-label"></label>
					    		<div class="input-group col-sm-7 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe um valor que será acrescido as mensalidades do formando, esse valor não é obrigatório"></i></span>
						    		<input class="form-control" id="valorID" type="text" name="valor" maxlength="60" readonly value=""  placeholder="Valor por Formando" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpValorID"></div>
							</div>
							
							<div class="form-group col-sm-12" >
			    				<label class="col-sm-4 control-label">
			    					<input name="indValorExtra" id="indValorExtraID" class="ace ace-switch" onchange="alteraIndTaxaExtraDesCad();" value="1" checked type="checkbox" />
			    					<span class="lbl" data-lbl="SIM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NÃO">&nbsp;&nbsp;</span>
			    				</label>
				    			<div class="input-group col-sm-7 pull-left">
				    				<span tabindex="99013" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Marque SIM para adicionar os valores extras (Taxa do Boleto caso a forma de pagamento seja boleto e o valor de administração) no valor da mensalidade"></i></span>
				    				<input readonly type="text" class="form-control" placeholder="Adicionar taxas extras (*)" aria-describedby="sizing-addon2" style="outline: none;  border-style: none none none solid !important;  -webkit-box-shadow: none !important;  -moz-box-shadow: none !important;  box-shadow: none !important;">
							    </div>
								<div class="help-block col-sm-1 inline" id="divHelpIndValorExtraID"></div>
					    	</div>

							<div class="form-group col-sm-12 hidden" id="divTextoSistemaID">
							    <label id='lblTextoSistemaID'	class="col-sm-4 control-label">SuaFormatura.com</label>
					    		<label id='textoSistemaID' 		class="col-sm-7 control-label pull-left" style="text-align: left;"></label>
							    <div class="col-sm-1 pull-left" id="divHelpTextoSistemaID"></div>
							</div>

							<div class="form-group col-sm-12 hidden" id="divTextoTaxasID">
							    <label id='lblTextoTaxasID' class="col-sm-4 control-label">Taxas</label>
					    		<div class="input-group col-sm-7 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Taxas incluídas na mensalidade (podem ser Boleto e Taxa de Administração)"></i></span>
						    		<input class="form-control" id="textoTaxasID" type="text" name="textoTaxas" readonly maxlength="60" autocomplete="off" >
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpTextoTaxasID"></div>
							</div>

							<div class="form-group col-sm-12 hidden" id="divTextoTotalID">
							    <label id='lblTextoTotalID' class="col-sm-4 control-label"><b>Total</b></label>
					    		<div class="input-group col-sm-7 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Mostra o valor total da conta ou da parcela (Somatório do valor informado + Taxas)"></i></span>
						    		<input class="form-control " id="textoTotalID" type="text" name="textoTotal" readonly maxlength="60" autocomplete="off">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpTextoTotalID"></div>
							</div>
					    	
							<div class="form-group col-sm-12" id="divFormaPagID">
								<label class="col-sm-4 control-label">Forma de Pag.</label>
				    			<div class="input-group col-sm-7 pull-left">
				    				<span tabindex="99011" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Selecione a Forma de Pagamento da Mensalidade"></i></span>
									<select class="select2" style="width:100%;" onchange="alteraFormaPagDesCad();" id="codFormaPagID" name="codFormaPag" data-rel="select2">
									%FORMAS_PAG%
									</select>
							    </div>
								<div class="help-block col-sm-1 inline" id="divHelpFormaPagID"></div>
					    	</div>
							<div class="form-group col-sm-12" id="divContaRecID">
								<label class="col-sm-4 control-label">Conta de Recebebimento</label>
				    			<div class="input-group col-sm-7 pull-left">
				    				<span tabindex="99012" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Conta de Recebimento (Conta que será creditado o valor)"></i></span>
									<select class="select2" style="width:100%;" onchange="alteraContaRecDesCad();" id="codContaRecID" name="codContaRec" data-rel="select2">
									%CONTAS%
									</select>
							    </div>
								<div class="help-block col-sm-1 inline" id="divHelpContaRecID"></div>
					    	</div>
						</div>
					</div>

					<div class="col-sm-4 pull-right" id="divInfoStep3ID">
						<div class="hidden-480">
							<div class="widget-box">
								<div class="widget-header widget-header-flat widget-header-small center">
									<h5 class="widget-title">Informações</h5>
								</div>
								<div class="widget-body">
									<div class="widget-main small">
										<div class="row">
											<div class="col-sm-12">
										    	<h5 id='lbInfoSaldoTituloStep3ID' class="col-sm-5 pull-left align-right inline" style="padding: 2px; margin:0;"></h5>
										    	<p id='lbInfoSaldoStep3ID' class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;"><b>Taxas:</b></p>
										    	<p id='lbInfoTaxasStep3ID' class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
											<div class="col-sm-12">
										    	<h5 id='lbInfoTotalTituloStep3ID' class="col-sm-5 pull-left align-right inline" style="padding: 2px; margin:0;"><b>Total:</b></h5>
										    	<p id='lbInfoTotalStep3ID' class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Pagamentos realizados:</h6>
										</div>					
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Mensalidades:</p>
										    	<p id='lbInfoSaldoMensalidadeStep3ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
										    	<p id='lbInfoSaldoPortalStep3ID' class="col-sm-7 pull-left align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row">
											<h6 class="header blue bolder smaller">&nbsp;Valores devidos:</h6>
										</div>					
										<div class="row">
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Multa:</p>
										    	<p id='lbInfoValDevidoMultaStep3ID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
										<div class="row" >
											<div class="col-sm-12">
										    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
										    	<p id='lbInfoValDevidoPortalStep3ID' class="col-sm-7 pull-left align-left" style="padding: 2px; margin:0;"></p>
									    	</div>
										</div>
									</div>
								</div>
							</div>
						</div>	
					</div>
				</div>
				
				<div class="step-pane" data-step="4" id="divStepParcelasDesCadID">
					<div class="row">
						<table id="tableValorDesCadID" class="paginated table table-condensed table-hover table-bordered bootstrap-datatable datatable display">
							<thead>
								<tr class="warning">
									<th class="col-sm-1 center" id="thInfoHelpTableParcelasDesCadID"></th>
									<th class="col-sm-1 center">Parcela</th>
									<th class="col-sm-2 center">Valor</th>
									<th class="col-sm-1 center">Taxas</th>
									<th class="col-sm-2 center">Total</th>
									<th class="col-sm-2 center">Data</th>
									
								</tr>
							</thead>
							<tbody>
							</tbody>
							<tfoot>
								<tr class="warning">
									<th class="col-sm-1 center"></th>
									<th class="col-sm-1 center" id="thInfoParcelaDesCadID"></th>
									<th class="col-sm-2 center" id="thInfoValorMensalidadeDesCadID"></th>
									<th class="col-sm-1 center" id="thInfoValorTaxaDesCadID"></th>
									<th class="col-sm-2 center" id="thInfoValorTotalDesCadID"></th>
									<th class="col-sm-2 center"></th>
								</tr>
							</tfoot>
						</table>
					</div>
					<div class="row center">
						<ul class="pagination" id="pagerValoresDesCadID">
						</ul>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="wizard-actions col-sm-2 pull-right" >
		<div class="col-sm-12 pull-left" >
			<!-- #section:plugins/fuelux.wizard.buttons -->
			<button class="btn btn-app btn-sm btn-prev">
				Anterior
				<i class="ace-icon fa fa-arrow-left"></i>
			</button>
			<button id="btnProxDesCadID" class="btn btn-app btn-sm btn-success btn-next" data-last="Finalizar">
				Próximo
				<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
			</button>
			<!-- /section:plugins/fuelux.wizard.buttons -->
		</div>
	</div>
</div>


<script>

$(document).one('ajaxloadstart.page', function(e) {
	//in ajax mode, remove remaining elements before leaving page
	$('[class*=select2]').remove();
});

$(".nav-tabs a[data-toggle=tab]").on("click", function(e) {
	if ($(this).hasClass("disabled")) {
		e.preventDefault();
		return false;
	}
});

/** Desabilitar os selects para a tela de View **/
$('[data-rel="select2"]').each(function( index ) {
	if ($(this).hasClass('readonly')) {
		$(this).select2("readonly", true);
	}else{
		$(this).select2({allowClear: true});
	}
});

$('[zg-data-toggle="mask"]').each(function( index ) {
	zgMask($( this ), $( this ).attr('zg-data-mask'));
});

$('[data-rel=tooltip]').tooltip();
$('[data-rel=popover]').popover({html:true});
$('[data-rel="select2"]').select2({allowClear: true});
$('.datepicker').datepicker({"autoclose": true});

$('textarea[class*=autosize]').autosize({append: "\n"});
$('textarea.limited').inputlimiter({
	remText: '%n caracteres restando...',
	limitText: 'Máximo Permitido : %n.'
});


$('#fuelux-wizard-container')
.ace_wizard({
	//step: 2 //optional argument. wizard will jump to step "2" at first
	//buttons: '.wizard-actions:eq(0)'
})
.on('actionclicked.fu.wizard' , function(e, info){
	if(info.step == 1) {
		var vOk 	= validaEventosDesCad();
		if(!vOk) 	{
			$.gritter.add({
				title: 'Seleção de eventos',
				text: 'Todos os eventos não podem ser selecionados',
				class_name: 'gritter-info gritter-center gritter-error'
			});
			e.preventDefault();
		}

		
	}else if (info.step == 2) {
		//var vOk 	= validaVencimentoDesCad();
		//if(!vOk) 	{
//			e.preventDefault();
		//}

		alteraFormaPagDesCad();
		
	}else if (info.step == 3) {
		var vOk 	= validaValoresDesCad();
		if(!vOk) 	{
			e.preventDefault();
		}else{
			criaTabelaValoresDesCad();
		}
	}
})
.on('finished.fu.wizard', function(e) {
	var vOk 	= atualizaEValidaParcelasDesCad();
	if(!vOk) 	{
		$.gritter.add({
			title: 'Valores inconsistentes',
			text: 'Ajuste os valores das parcelas !!!!',
			class_name: 'gritter-info gritter-center gritter-error'
		});

		e.preventDefault();
		return false;
	}else{
		$('#zgFormDesCadID').submit();
	}
	
}).on('stepclick.fu.wizard', function(e){
	//e.preventDefault();//this will prevent clicking and selecting steps
});

calculaValoresPagosDesCad();
function calculaValoresPagosDesCad() {
	var $valPagoMensalidade		= zgConverteFloat($('#valPagoMensalidadeID').val());
	var $valPagoPortal			= zgConverteFloat($('#valPagoPortalID').val());
	var $valTotalMensalidade	= zgConverteFloat($('#valTotalMensalidadeID').val());
	var $taxaAdmin				= zgConverteFloat($('#taxaAdminID').val());
	
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	/** Atualizar o quadro **/
	$('#lbInfoSaldoMensalidadeStep1ID').html(accounting.formatMoney($valPagoMensalidade,$opt));
	$('#lbInfoSaldoMensalidadeStep2ID').html(accounting.formatMoney($valPagoMensalidade,$opt));
	$('#lbInfoSaldoMensalidadeStep3ID').html(accounting.formatMoney($valPagoMensalidade,$opt));
	$('#lbInfoSaldoPortalStep1ID').html(accounting.formatMoney($valPagoPortal,$opt));
	$('#lbInfoSaldoPortalStep2ID').html(accounting.formatMoney($valPagoPortal,$opt));
	$('#lbInfoSaldoPortalStep3ID').html(accounting.formatMoney($valPagoPortal,$opt));
	$('#lbInfoValorFormaturaStep1ID').html(accounting.formatMoney($valTotalMensalidade,$opt));
	$('#lbInfoValorFormaturaStep2ID').html(accounting.formatMoney($valTotalMensalidade,$opt));
	$('#lbInfoValorFormaturaStep3ID').html(accounting.formatMoney($valTotalMensalidade,$opt));
	
	if ($taxaAdmin > 0)		{
		$('#divInfoTaxaAdminID').removeClass("hidden");
	}else{
		$('#divInfoTaxaAdminID').addClass("hidden");
	}
	
	calculaValorTotalEventoDesCad();
	
}

function calculaValorTotalEventoDesCad() {
	var $aSelEventos			= [];
	var $totalEventos			= 0;
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	$('input[name="codEventoSel[]"]:checked').each( function() {
		var $codEvento						= $(this).val();
		$aSelEventos[$aSelEventos.length]	= $codEvento;
		$input								= $('input[zg-codigo="'+$codEvento+'"]');
		$valorEvento						= zgConverteFloat($input.val());
		$totalEventos						+= $valorEvento;
	});
	
	/** Atualiza a variável valTotalEventos **/
	$('#valTotalEventosID').val($totalEventos);
	
	// Atualiza total evento	
	$('#lbInfoTotalEventosStep1ID').html(accounting.formatMoney($totalEventos,$opt));
	$('#lbInfoTotalEventosStep2ID').html(accounting.formatMoney($totalEventos,$opt));
	$('#lbInfoTotalEventosStep3ID').html(accounting.formatMoney($totalEventos,$opt));
	calculaSaldoDesCad();
}

function calculaSaldoDesCad() {
	var $valPagoMensalidade		= zgConverteFloat($('#valPagoMensalidadeID').val());
	var $valPagoPortal			= zgConverteFloat($('#valPagoPortalID').val());
	var $valTotalMensalidade	= zgConverteFloat($('#valTotalMensalidadeID').val());
	var $valTotalSistema		= zgConverteFloat($('#valTotalSistemaID').val());
	var $valDevidoSistema		= zgConverteFloat($('#valDevidoSistemaID').val());
	var $codTipoBaseCalculo		= $('#codTipoBaseCalculoID').val();
	var $baseCalculo;
	var $saldoMensalidade;
	var $valMulta				= 0;
	
	var $pctMulta				= $('#pctMultaID').val();
	var $saldoSistema			= 0;
		
	var $aSelEventos			= [];
	var $totalEventos			= 0;
	var $numEventosSel			= 0;
	var $total;
	$pctMulta					= zgConverteFloat($pctMulta.replace('%',''));
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	$('input[name="codEventoSel[]"]:checked').each( function() {
		var $codEvento						= $(this).val();
		$aSelEventos[$aSelEventos.length]	= $codEvento;
		$input								= $('input[zg-codigo="'+$codEvento+'"]');
		$valorEvento						= zgConverteFloat($input.val());
		$totalEventos						+= $valorEvento;
		$numEventosSel						+= 1;
	});
	
	/** Calcular a base de calculo **/
	if ($codTipoBaseCalculo == "P")	{
		$baseCalculo		= $valPagoMensalidade;
	}else{
		$baseCalculo		= $valTotalMensalidade;
	}
	
	/** Calcular a multa **/
	$valMulta				= zgConverteFloat($baseCalculo * $pctMulta / 100);
	if ($valMulta < 0)		{$valMulta	= 0;}
	
	/** Calcular o saldo da Mensalidade **/
	$saldoMensalidade		= zgConverteFloat($totalEventos - $valPagoMensalidade);
	
	/** Saldo do Sistema **/
	if ($numEventosSel > 0) { 	// Desistência parcial
		$saldoSistema		= zgConverteFloat($valTotalSistema - $valPagoPortal);
		$valDevidoSistema	= $valTotalSistema;
	}else{						// Desistência total
		$saldoSistema		= zgConverteFloat($valDevidoSistema - $valPagoPortal);
	}
	
	
	/** Calcular o saldo final **/
	$total					= zgConverteFloat($valMulta + $saldoMensalidade + $saldoSistema).toFixed(2);
	//alert("Total: "+$total+" ValMulta:"+$valMulta+" SaldoMensalidade: "+$saldoMensalidade+" SaldoSistema: "+$saldoSistema +" valPagoMensalidade: "+$valPagoMensalidade+" valPagoPortal: "+$valPagoPortal+" valTotalMensalidade: "+$valTotalMensalidade +" valTotalSistema: "+$valTotalSistema);
	
	$('#lbInfoSaldoSistemaID').html(accounting.formatMoney($saldoSistema,$opt));
	$('#lbInfoValDevidoMultaStep2ID').html(accounting.formatMoney($valMulta,$opt));
	$('#lbInfoValDevidoMultaStep3ID').html(accounting.formatMoney($valMulta,$opt));
	$('#lbInfoValDevidoPortalStep2ID').html(accounting.formatMoney($valDevidoSistema,$opt));
	$('#lbInfoValDevidoPortalStep3ID').html(accounting.formatMoney($valDevidoSistema,$opt));

	/** Atualiza as variáveis com os saldos devidos **/
	$('#saldoSistemaID').val($saldoSistema);
	$('#saldoMensalidadeID').val($saldoMensalidade);
	$('#saldoMultaID').val($valMulta);

	
	if ($total < 0) {
		$total			= ($total * -1);
		$('#lbInfoSaldoTituloStep2ID').removeClass("text-danger");
		$('#lbInfoSaldoTituloStep3ID').removeClass("text-danger");
		$('#lbInfoTotalTituloStep3ID').removeClass("text-danger");
		$('#lbInfoSaldoTituloStep2ID').addClass("text-success");
		$('#lbInfoSaldoTituloStep3ID').addClass("text-success");
		$('#lbInfoTotalTituloStep3ID').addClass("text-success");
		$('#lbInfoSaldoStep2ID').html('<b>'+accounting.formatMoney($total,$opt)+'</b>');
		$('#lbInfoSaldoStep3ID').html('<b>'+accounting.formatMoney($total,$opt)+'</b>');
		$('#lbInfoSaldoTituloStep2ID').html('<b>A Receber:</b>');
		$('#lbInfoSaldoTituloStep3ID').html('<b>A Receber:</b>');
		$('#lblTipoValorID').html('<b>A Receber:</b>');
		
	}else{
		$('#lbInfoSaldoTituloStep2ID').removeClass("text-success");
		$('#lbInfoSaldoTituloStep3ID').removeClass("text-success");
		$('#lbInfoTotalTituloStep3ID').removeClass("text-success");
		$('#lbInfoSaldoTituloStep2ID').addClass("text-danger");
		$('#lbInfoSaldoTituloStep3ID').addClass("text-danger");
		$('#lbInfoTotalTituloStep3ID').addClass("text-danger");
		$('#lbInfoSaldoStep2ID').html('<b>'+accounting.formatMoney($total,$opt)+'</b>');
		$('#lbInfoSaldoStep3ID').html('<b>'+accounting.formatMoney($total,$opt)+'</b>');
		$('#lbInfoSaldoTituloStep2ID').html('<b>A Pagar:</b>');
		$('#lbInfoSaldoTituloStep3ID').html('<b>A Pagar:</b>');
		$('#lblTipoValorID').html('<b>A Pagar:</b>');
	}
}

function alteraBaseCalculoDesCad() {
	calculaSaldoDesCad();
}


function alteraPctMultaDesCad() {
	calculaSaldoDesCad();
}

function validaEventosDesCad() {
	var $numEventos		= $('#numEventosID').val();
	var $numEventosSel	= 0;
	
	$('input[name="codEventoSel[]"]:checked').each( function() {
		$numEventosSel						+= 1;
	});
	
	if ($numEventos == $numEventosSel)	{
		return false;
	}
	
	return true;
}

function alteraFormaPagDesCad() {
	alteraContaRecDesCad();
}

function alteraContaRecDesCad() {
	var $oConta				= $("#codContaRecID option:selected");
	var $valorBoleto		= zgConverteFloat($oConta.attr("zg-val-boleto"));
	var $codFormaPag		= $('#codFormaPagID').val();

	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	if ($codFormaPag  == "BOL")	{
		$('#divInfoBoletoID').removeClass("hidden");
		$('#lblTaxaBoletoID').html(accounting.formatMoney($valorBoleto,$opt))
		$('#taxaBolID').val($valorBoleto);
	}else{
		$('#divInfoBoletoID').addClass("hidden");
		$('#lblTaxaBoletoID').html(accounting.formatMoney(0,$opt))
		$('#taxaBolID').val(0);
	}
	atualizaInfoDesCad();
}


function atualizaInfoDesCad() {

	var $numMeses			= parseInt($('#numMesesID').val());
	var $indValorExtra		= $('#indValorExtraID:checked').length;
	var $taxaAdm			= zgConverteFloat('%TAXA_ADMIN%');
	var $oConta				= $("#codContaRecID option:selected");
	var $valorBoleto		= zgConverteFloat($oConta.attr("zg-val-boleto"));
	var $codFormaPag		= $('#codFormaPagID').val();
	var $saldoSistema		= zgConverteFloat($('#saldoSistemaID').val());
	var $saldoMensalidade	= zgConverteFloat($('#saldoMensalidadeID').val());
	var $saldoMulta			= zgConverteFloat($('#saldoMultaID').val());
	var $total				= zgConverteFloat($saldoMulta + $saldoMensalidade + $saldoSistema);
	var $valor				= zgConverteFloat($saldoMulta + $saldoMensalidade);

	//alert("SaldoSistema: "+$saldoSistema+" SaldoMensalidade: "+$saldoMensalidade+" SaldoMulta:"+$saldoMulta+" Valor: "+$valor);
	
	var $taxas,$taxaBol,$totalTaxas,$totalSistema,$valParcelaMensalidade,$valParcelaSistema,$valParcelaTaxa,$valTotalMensalidade,$valTotalSistema,$valTotalTaxa;
	var $textoTaxa,$textoSistema,$textoTotal,$indCreDebSistema,$indCreDebMensalidade;
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	var $opt1 = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	
	/** Atualizar o campo Valor **/
	$('#valorID').val(accounting.formatMoney($valor,$opt1)).trigger("change");

	/** Somente cobrar o boleto, caso a forma de pagamento seja boleto **/
	if ($codFormaPag  == "BOL")	{
		$taxaBol		= $valorBoleto;
	}else{
		$taxaBol		= 0;
	}
	
	/** Só adicionar as taxas caso esteja marcado para isso **/
	if ($indValorExtra)	{
		/** Calcular o valor total de taxas **/
		$taxas			= $taxaAdm + $taxaBol;
	}else{
		$taxas			= 0
	}

	if ($total			< 0) {
		$('#codTipoContaID').val("R");
	}else if ($total == 0) {
		$('#codTipoContaID').val("N");
	}else{
		$('#codTipoContaID').val("P");
	}
	
	if ($saldoSistema	< 0)		{
		//$saldoSistema		= $saldoSistema * -1;
		$indCreDebSistema	= "<span class='text-success'>(A Receber)</span>";
	}else{
		$indCreDebSistema	= "<span class='text-danger'>(A Pagar)</span>";
	}
	
	/** Salvar os valores que ficará de taxa **/
	$valParcelaTaxa			= $taxas;
	$valTotalTaxa			= ($taxas * $numMeses);
	if ($valor			< 0)		{
		$valTotalTaxa		= $valTotalTaxa * -1;
	}

	/** Salvar os valores que ficará de mensalidade **/
	$valParcelaMensalidade	= zgConverteFloat(($valor / $numMeses).toFixed(2));
	$valTotalMensalidade	= zgConverteFloat($valor);
	
	/** Salvar os valores que ficará de Sistema **/
	$valParcelaSistema		= zgConverteFloat(($saldoSistema / $numMeses).toFixed(2));
	$valTotalSistema		= $saldoSistema;
	
	/** Atualiza os totais **/
	var $totalParcela		= zgConverteFloat(($valParcelaTaxa	+ $valParcelaSistema	+ $valParcelaMensalidade).toFixed(2));
	var $totalGeral			= zgConverteFloat(($valTotalTaxa	+ $valTotalSistema		+ $valTotalMensalidade).toFixed(2));

	if ($valParcelaTaxa	< 0)			{$valParcelaTaxa		= $valParcelaTaxa 			* -1;}
	if ($valTotalTaxa	< 0)			{$valTotalTaxa			= $valTotalTaxa 			* -1;}

	if ($valParcelaMensalidade	< 0)	{$valParcelaMensalidade	= $valParcelaMensalidade 	* -1;}
	if ($valTotalMensalidade	< 0)	{$valTotalMensalidade	= $valTotalMensalidade	 	* -1;}
	
	if ($valParcelaSistema		< 0)	{$valParcelaSistema		= $valParcelaSistema	 	* -1;}
	if ($valTotalSistema		< 0)	{$valTotalSistema		= $valTotalSistema		 	* -1;}

	if ($totalParcela	< 0)			{$totalParcela			= $totalParcela 			* -1;}
	if ($totalGeral		< 0)			{$totalGeral			= $totalGeral 				* -1;}
	
	//alert("valParcelaSistema: "+$valParcelaSistema+" valTotalSistema: "+$valTotalSistema+" valParcelaMensalidade: "+$valParcelaMensalidade+" valTotalMensalidade: "+$valTotalMensalidade+" saldoSistema: "+$saldoSistema+" saldoMensalidade:"+$saldoMensalidade+" saldoMulta: "+$saldoMulta);
	
	/** Gera os textos informativos dos campos **/
	$textoTaxa				= $numMeses + "x" + " " + accounting.formatMoney($valParcelaTaxa,$opt) + " = " + accounting.formatMoney($valTotalTaxa,$opt); 
	$textoSistema			= $numMeses + "x" + " " + accounting.formatMoney($valParcelaSistema,$opt) + " = " + accounting.formatMoney($valTotalSistema,$opt) + "&nbsp;" + $indCreDebSistema; 
	$textoTotal				= $numMeses + "x" + " " + accounting.formatMoney($totalParcela,$opt) + " = " + accounting.formatMoney($totalGeral,$opt); 
	
	/** Salvar os valores de parcela **/
	$('#valParcelaMensalidadeID').val($valParcelaMensalidade);
	$('#valParcelaSistemaID').val($valParcelaSistema);
	$('#valParcelaTaxaID').val($valParcelaTaxa);
	$('#totalParcelaID').val($totalParcela);

	/** Salvar os valores totais **/
	$('#_valTotalMensalidadeID').val($valTotalMensalidade);
	$('#_valTotalSistemaID').val($valTotalSistema);
	$('#_valTotalTaxaID').val($valTotalTaxa);
	$('#totalGeralID').val($totalGeral);

	
	
	$('#lbInfoTaxasStep3ID').html($textoTaxa);
	$('#lbInfoTotalStep3ID').html("<b>"+$textoTotal+"</b>");
	//$('#textoTaxasID').val($textoTaxa);
	//$('#textoSistemaID').html($textoSistema);
	//$('#textoSistemaID').val($textoSistema);
	$('#textoTotalID').val($textoTotal);
}

function alteraIndTaxaExtraDesCad() {
	atualizaInfoDesCad();
}

function validaValoresDesCad() {
	var vValor			= $('#valorID').val();
	var vCodFormaPag	= $('#codFormaPagID').val();
	var vCodContaRec	= $('#codContaRecID').val();
	var vOK				= true;
	
	// Forma de Pagamento
	if (!vCodFormaPag) {
		$('#divFormaPagID').addClass('has-error');
		$('#divHelpFormaPagID').html(zgCriaSpanErro('Forma de pagamento deve ser selecionada !!!'));
		vOK		= false;
	}else{
		$('#divFormaPagID').removeClass('has-error');
		$('#divHelpFormaPagID').html('&nbsp;');
	}
	
	// Conta
	if (!vCodContaRec) {
		$('#divContaRecID').addClass('has-error');
		$('#divHelpContaRecID').html(zgCriaSpanErro('Conta de Recebimento deve ser selecionada !!!'));
		vOK		= false;
	}else{
		$('#divContaRecID').removeClass('has-error');
		$('#divHelpContaRecID').html('&nbsp;');
	}

	return vOK;
}


function criaTabelaValoresDesCad() {
	var $table					= $('#tableValorDesCadID');
	var $tipoRecParc;
	var $codPeriodoRec			= 'M';
	var $intervaloRec			= 1;
	var $dataVenc				= $('#dataVencID').val();
	var $numMeses				= parseInt($('#numMesesID').val());
	var $parcelas;
	var $nValor,$valor,$valorParcela,$valorTotal,$datas;

	var $valParcelaMensalidade	= zgConverteFloat($('#valParcelaMensalidadeID').val());
	var $valParcelaSistema		= zgConverteFloat($('#valParcelaSistemaID').val());
	var $valParcelaTaxa			= zgConverteFloat($('#valParcelaTaxaID').val());

	var $valTotalMensalidade	= zgConverteFloat($('#_valTotalMensalidadeID').val());
	var $valTotalSistema		= zgConverteFloat($('#_valTotalSistemaID').val());
	var $valTotalTaxa			= zgConverteFloat($('#_valTotalTaxaID').val());
	
	var $valTotalGeral			= zgConverteFloat($('#totalGeralID').val());
	var $totMen					= zgConverteFloat((zgConverteFloat($valTotalMensalidade) + zgConverteFloat($valTotalSistema)).toFixed(2));
	var $_parc,$_sis,$_taxa,$_tot;
	
	
	if ($('#codTipoContaID').val() == "N") {
		return true;
	};
	
	//alert("valParcelaMensalidade: "+$valParcelaMensalidade+" valTotalMensalidade:"+$valTotalMensalidade+" valTotalGeral: "+$valTotalGeral);

	var options = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
		
	var optTotal = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};


	$parcelas		= $numMeses;	
	if ($parcelas <= 1) {
		$tipoRecParc	= "U";
	}else{
		$tipoRecParc	= "P";
	}
	
	/** Resgata as datas de vencimentos **/
	jQuery.ajax({
		url: "%ROOT_URL%/Fin/geraDatasVencimentoConta.dp.php",
		data: { dataVenc: $dataVenc, codPeriodoRec: $codPeriodoRec, intervaloRec: $intervaloRec, numParcelas: $parcelas},
		success: function(ret) {
			$datas	= JSON.parse(ret);
		},
		method: 'get',
		cache: false,
		async:false
	});

	/** Remove os dados atuais **/
	$('#tableValorDesCadID > tbody').find('tr').remove();
	
	for ($i = 0; $i < $parcelas; $i++) {
		var $descParcela	= ($i+1) + " / " + $parcelas;
		
		if ($tipoRecParc == "U") {
			$_parc	= zgConverteFloat((zgConverteFloat($valTotalMensalidade) + zgConverteFloat($valTotalSistema)).toFixed(2));
			//$_sis	= $valTotalSistema;
			$_taxa	= $valTotalTaxa;
		}else{
			if ($i == ($parcelas -1)) {
				$_parc	= zgConverteFloat($totMen	- ((zgConverteFloat($valParcelaMensalidade)+zgConverteFloat($valParcelaSistema))	* ($parcelas -1) ));
				//$_sis	= zgConverteFloat($valTotalSistema		- ($valParcelaSistema		* ($parcelas -1) ));
				$_taxa	= zgConverteFloat($valParcelaTaxa);
			}else{
				$_parc 	= zgConverteFloat((zgConverteFloat($valParcelaMensalidade) + zgConverteFloat($valParcelaSistema)).toFixed(2));
				//$_sis 	= $valParcelaSistema;
				$_taxa 	= $valParcelaTaxa;
			}
		}
		
		//$_tot			= zgConverteFloat($_parc) + zgConverteFloat($_sis) + zgConverteFloat($_taxa);
		$_tot			= zgConverteFloat($_parc) + zgConverteFloat($_taxa);
		var $_parcFmt	= accounting.formatMoney($_parc	,options);
		//var	$_sisFmt	= accounting.formatMoney($_sis	,options);
		var $_taxaFmt	= accounting.formatMoney($_taxa	,options);
		var $_totFmt	= accounting.formatMoney($_tot	,options);
		
		//alert("$_tot: "+$_tot+" $_totFmt:"+$_totFmt);

		$('#tableValorDesCadID > tbody:last').append('<tr><td class="center" style="width: 18px;"><div class="inline" zg-type="zg-div-msg"></div></td><td class="center" style="width: 30px;">'+$descParcela+'</td><td style="width: 120px;"><input type="text" class="form-control input-sm" name="aValor[]" value="'+$_parcFmt+'" onchange="atualizaEValidaParcelasDesCad();" maxlength="20" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0"></td><td style="width: 80px;"><input type="text" class="form-control input-sm" name="aTaxas[]" value="'+$_taxaFmt+'" readonly maxlength="20" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0"></td><td style="width: 120px;"><input type="text" class="form-control input-sm" name="aTotal[]" readonly value="'+$_totFmt+'"  maxlength="20" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0"></td><td style="width: 120px;"><input type="text" class="form-control input-sm datepicker" name="aData[]" value="'+$datas[$i].dataVenc+'" onchange="atualizaEValidaParcelasDesCad();" maxlength="10" autocomplete="off" zg-data-toggle="mask" zg-data-mask="data"></td></tr>');		

		$('#tableValorDesCadID > tbody > tr:last [zg-data-toggle="mask"]').each(function( index ) {
			zgMask($( this ), $( this ).attr('zg-data-mask'));
			$( this ).trigger('keyup');
		});
		
		$('#tableValorDesCadID > tbody > tr:last .datepicker').each(function( index ) {
			$(this).datepicker({"autoclose": true});
		});
		
	}

	$('#thInfoValorMensalidadeDesCadID').html(accounting.formatMoney($totMen,optTotal));
	//$('#thInfoValorSistemaDesCadID').html(accounting.formatMoney($valTotalSistema,optTotal));
	$('#thInfoValorTaxaDesCadID').html(accounting.formatMoney($valTotalTaxa,optTotal));
	$('#thInfoValorTotalDesCadID').html(accounting.formatMoney($valTotalGeral,optTotal));
	$('#thInfoParcelaDesCadID').html($parcelas);
	atualizaEValidaParcelasDesCad();
	paginateTableValoresDesCad();
}


function paginateTableValoresDesCad() {
	$('#pagerValoresDesCadID li').remove();

	$('table.paginated').each(function() {
	    var currentPage = 0;
	    var numPerPage 	= 5;
	    var $table = $(this);
	    $table.bind('repaginate', function() {
	        $table.find('tbody tr').hide().slice(currentPage * numPerPage, (currentPage + 1) * numPerPage).show();
	    });
	    $table.trigger('repaginate');
	    var numRows = $table.find('tbody tr').length;
	    var numPages = Math.ceil(numRows / numPerPage);
	    var $pager = $('#pagerValoresDesCadID');
	    for (var page = 0; page < numPages; page++) {
	    	$('<li><a href="#"><span class="page-number">'+(page + 1)+'</span></a></li>').bind('click', {
	        //$('<span class="page-number"></span>').text(page + 1).bind('click', {
	            newPage: page
	        }, function(event) {
	            currentPage = event.data['newPage'];
	            $table.trigger('repaginate');
	            $(this).addClass('active').siblings().removeClass('active');
	        }).appendTo($pager).addClass('clickable');
	    }
	    $pager.insertBefore($table).find('span.page-number:first').addClass('active');
	});
}

function atualizaEValidaParcelasDesCad() {
	var $tValMensalidade		= parseFloat(0);
	var $tValSistema			= parseFloat(0);
	var $cem					= (100+0).toFixed(2);
	var $htmlOK					= zgCriaSpanOK();
	var $htmlError1				= false;
	var $htmlError2				= false;
	var $htmlError3				= false;
	var $epsilon				= 0.00000001;
	var $vOK					= true;
	var $menorData;
	var $tipoRecParc;
	var $numMeses				= parseInt($('#numMesesID').val());
	var $valorParcela			= $('#valParcelaMensalidadeID').val();
	var $valorTotal				= $('#_valTotalMensalidadeID').val();
	var $parcelas;

	var $valParcelaMensalidade	= $('#valParcelaMensalidadeID').val();
	var $valParcelaSistema		= $('#valParcelaSistemaID').val();
	var $valParcelaTaxa			= $('#valParcelaTaxaID').val();
	var $valTotalMensalidade	= $('#_valTotalMensalidadeID').val();
	var $valTotalSistema		= $('#_valTotalSistemaID').val();
	var $valTotalTaxa			= $('#_valTotalTaxaID').val();
	var $valTotalGeral			= $('#totalGeralID').val();
	var $totMen					= zgConverteFloat((zgConverteFloat($valTotalMensalidade) + zgConverteFloat($valTotalSistema)).toFixed(2));
	

	if ($('#codTipoContaID').val() == "N") {
		return true;
	};

	var opt = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	var opt1 = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
		
	var opt2 = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	/** Calcula a soma dos valores de Mensalidade e Sistema, para verificar se bate com o total de cada um **/
	$('#tableValorDesCadID > tbody > tr').each(function( index ) {
		
		var $_valMen,$_valSis,$_valTaxas,$_valTotal;
		$(this).find('[name*="aValor[]"]').each(function( index2 ) {
			$_valMen		 	= zgConverteFloat($(this).val());
			$tValMensalidade	+= $_valMen;
		});
		/*$(this).find('[name*="aSistema[]"]').each(function( index3 ) {
			$_valSis			= zgConverteFloat($(this).val());
			$tValSistema 		+= $_valSis;
		});*/
		$(this).find('[name*="aTaxas[]"]').each(function( index4 ) {
			$_valTaxas			= zgConverteFloat($(this).val());
		});
		
		/** Atualiza o valor total com a soma dos outros valores **/
		$(this).find('[name*="aTotal[]"]').each(function( index5 ) {
			$_valTotal			= zgConverteFloat($_valMen + $_valTaxas);
			$(this).val(accounting.formatMoney($_valTotal, opt));
		});

	});

	/** Ajusta os valores totais **/
	$tValMensalidade		= zgConverteFloat($tValMensalidade.toFixed(2));
	//$tValSistema			= zgConverteFloat($tValSistema.toFixed(2));

	/** Calcula o tipo de recorrência através do número de parcelas **/
	if ($numMeses <= 1) {
		$tipoRecParc	= "U";
	}else{
		$tipoRecParc	= "P";
	}

	//alert("Valor total:"+$totMen+" Valor Calculado: "+$tValMensalidade);
	/** Valida os valores **/
	if ($totMen != $tValMensalidade) {
		var $textoMensalidade;
		var	$diffMensalidade	= ($totMen - $tValMensalidade);
		
		if ($diffMensalidade > 0) {
			$textoMensalidade	= "Falta ainda: "+accounting.formatMoney($diffMensalidade, opt1);
		}else{
			$textoMensalidade	= "Valor está a maior: "+accounting.formatMoney(($diffMensalidade*-1), opt1);
		}
		
		$htmlError1	= zgCriaSpanErro($textoMensalidade);
		$vOK		= false;
	}
	
	/*if ($valTotalSistema != $tValSistema) {
		var $textoSistema;
		var	$diffSistema	= ($valTotalSistema - $tValSistema);
		
		if ($diffSistema > 0) {
			$textoSistema	= "Falta ainda: "+accounting.formatMoney($diffSistema, opt1);
		}else{
			$textoSistema	= "Valor está a maior: "+accounting.formatMoney(($diffSistema*-1), opt1);
		}
		
		$htmlError2	= zgCriaSpanErro($textoSistema);
		$vOK		= false;
	}*/

	
	if ($htmlError1) {
		$('#thInfoValorMensalidadeDesCadID').html($htmlError1);
	}else{
		$('#thInfoValorMensalidadeDesCadID').html($htmlOK + "&nbsp;"+ accounting.formatMoney($totMen, opt1));
	}

	/*if ($htmlError2) {
		$('#thInfoValorSistemaDesCadID').html($htmlError2);
	}else{
		$('#thInfoValorSistemaDesCadID').html($htmlOK + "&nbsp;"+  accounting.formatMoney($valTotalSistema, opt1));
	}*/
	
	/** Valida Data **/
	$('#tableValorDesCadID > tbody > tr [name*="aData[]"]').each(function( index ) {
		var $td		= $(this).parent();
		var $tr		= $td.parent();

		if (index == 0) {
			$menorData = moment($(this).val(), "%FORMATO_DATA%");
			$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanOK());
		}else{
			var $data	= moment($(this).val(), "%FORMATO_DATA%");
			var $dif	= $data - $menorData; 
			
			if ($dif < 0) {
				$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanErro("Data deve ser maior do que a parcela anterior"));
				$tr.addClass("alert-danger");
				$vOK		= false;
				$htmlError3	= zgCriaSpanErro("Verifique as datas dos registros marcados");
			}else{
				$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanOK());
				$tr.removeClass("alert-danger");
			}
			$menorData = moment($(this).val(), "%FORMATO_DATA%");
		}
	});

	
	if ($htmlError3) {
		$('#thInfoHelpTableParcelasDesCadID').html($htmlError3);
	}else{
		$('#thInfoHelpTableParcelasDesCadID').html(zgCriaSpanOK());
	}

	return $vOK;
	
}

</script>