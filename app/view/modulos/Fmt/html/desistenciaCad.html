<div id="content">
	<div class="page-header">
	<h1>Desistência</h1>
	</div><!-- /.page-header -->
	<br />

	<!-- #section:plugins/fuelux.wizard -->
	<div id="fuelux-wizard-container" class="col-sm-10 pull-left">
		<div>
			<!-- #section:plugins/fuelux.wizard.steps -->
			<ul class="steps">
				<li data-step="1" class="active">
					<span class="step">1</span>
					<span class="title">Eventos</span>
				</li>
				<li data-step="2">
					<span class="step">2</span>
					<span class="title">Valores</span>
				</li>
				<li data-step="3">
					<span class="step">3</span>
					<span class="title">Parcelas</span>
				</li>
			</ul>
		</div>
		<hr />
		<form id="zgFormGeraMensalidadeID" class="form-horizontal">
			<input type="hidden" name="id" value="%ID%">
			<input type="hidden" name="codFormando" id="codFormandoID">
			<input type="hidden" name="saldoTotalFormando" id="saldoTotalFormandoID">
			<input type="hidden" name="saldoSistemaFormando" id="saldoSistemaFormandoID">
			<input type="hidden" id="valorFormaturaFormandoID" value="%VALOR_FORMATURA%">
			<input type="hidden" id="saldoMensalidadeFormandoID" value="%SALDO_MENSALIDADE%">
			<input type="hidden" id="saldoPortalFormandoID" value="%SALDO_PORTAL%">
			<input type="hidden" name="valTotalMensalidade" id="valTotalMensalidadeID">
			<input type="hidden" name="valTotalSistema" id="valTotalSistemaID">
			
			<div class="step-content pos-rel">
							
				<div class="step-pane" data-step="1">
					<div class="col-sm-7 pull-left">
						<div class="row">
							<div class="col-xs-12 col-sm-12">
								<div class="control-group">
										%HTML_EVENTOS%
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-5 hidden-480">
						<div class="widget-box">
							<div class="widget-header widget-header-flat widget-header-small center">
								<h5 class="widget-title">Informações</h5>
							</div>
							<div class="widget-body">
								<div class="widget-main small">
									<div class="row" id="divInfoCustoID">
										<div class="col-sm-12">
									    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor da formatura:</p>
									    	<p id='lbInfoValorFormaturaID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
								    	</div>
									</div>	
									<div class="row" id="divInfoConfID">
										<h6 class="header blue bolder smaller">&nbsp;Pagamentos realizados:</h6>
									</div>					
									<div class="row" id="divInfoCustoID">
										<div class="col-sm-12">
									    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Mensalidades:</p>
									    	<p id='lbInfoSaldoMensalidadeID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
								    	</div>
									</div>
									<div class="row" id="divInfoValorID">
										<div class="col-sm-12">
									    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Portal:</p>
									    	<p id='lbInfoSaldoPortalID' class="col-sm-8 pull-left align-left" style="padding: 2px; margin:0;"></p>
								    	</div>
									</div>
									<div class="row" id="divInfoConfID">
										<h6 class="header blue bolder smaller">&nbsp;Saldo:</h6>
									</div>
									<div class="row" id="divInfoValEventoID">
										<div class="col-sm-12">
									    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Total dos eventos:</p>
									    	<p id='lbInfoTotalEventosID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
								    	</div>
									</div>
									<div class="row" id="divInfoValEventoID">
										<div class="col-sm-12">
									    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Total do portal:</p>
									    	<p id='lbInfoTotalPortalID' class="col-sm-7 pull-left" style="padding: 2px; margin:0;"></p>
								    	</div>
									</div>
									<div class="row" id="divInfoValEventoID">
										<div class="col-sm-12">
									    	<p id='lbInfoSaldoTituloID' class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;"></p>
									    	<p id='lbInfoSaldoID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"><b></b></p>
								    	</div>
									</div>
								</div>
							</div>
						</div>
					</div>	
				</div>
				<div class="step-pane active" data-step="2">
				<div class="col-sm-8 pull-left">
						<div class="row ">
							
							<div class="form-group col-sm-12" id="divIndValorTotalID">
								<label class="col-sm-4 control-label">Calcular por:</label>
								<div class="btn-group btn-corner col-sm-7 pull-left">
									<span id='geraMensalidadeValorMensalidadeID' style="width: 150px;" class="btn btn-sm" onclick="selecionaValorMensalidadeGeraMensalidade();">Valor pago</span>
									<span tabindex="99007" class="btn btn-sm btn-info"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe se o valor informado é o valor da Mensalidade, ou o valor total da Formatura para o formando"></i></span>
									<span id='geraMensalidadeValorTotalID' style="width: 150px;" class="btn btn-sm" onclick="selecionaValorTotalGeraMensalidade();">Valor da formatura</span>
								</div>
							</div>
							<div class="form-group col-sm-12" id="divValorID">
							    <label id='lblTipoValorID' class="col-sm-4 control-label">Porcentagem de multa</label>
					    		<div class="input-group col-sm-7 pull-left">
				    				<span class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe um valor que será acrescido as mensalidades do formando, esse valor não é obrigatório"></i></span>
						    		<input class="form-control" id="porcentagem" type="text" name="valor" maxlength="60" value="" onchange="alteraValorPrincipalGeraMensalidade();" placeholder="Valor por Formando" autocomplete="off" zg-data-toggle="mask" zg-data-mask="porcentagem">
							    </div>
							    <div class="col-sm-1 pull-left" id="divHelpValorID"></div>
							</div>							
						</div>
					</div>
					<div class="col-sm-4 pull-right" zg-div-limpa="1" id="divInfoValorID"></div>
				</div>
				<div class="step-pane" data-step="3" id="divStepParcelasGeraMensalidadeID">
					<div class="row">
						<table id="GeraMensalidadeTableValorID" class="paginated table table-condensed table-hover table-bordered bootstrap-datatable datatable display">
							<thead>
								<tr class="warning">
									<th class="col-sm-1 center" id="thInfoHelpTableParcelasGeraMensalidadeID"></th>
									<th class="col-sm-2 center">Parcela</th>
									<th class="col-sm-2 center">Valor</th>
									<th class="col-sm-1 center">Portal</th>
									<th class="col-sm-1 center">Taxas</th>
									<th class="col-sm-2 center">Total</th>
									<th class="col-sm-2 center">Data</th>
									
								</tr>
							</thead>
							<tbody>
							</tbody>
							<tfoot>
								<tr class="warning">
									<th class="col-sm-1 center"></th>
									<th class="col-sm-2 center" id="thInfoParcelaGeraMensalidadeID"></th>
									<th class="col-sm-2 center" id="thInfoValorMensalidadeGeraMensalidadeID"></th>
									<th class="col-sm-1 center" id="thInfoValorSistemaGeraMensalidadeID"></th>
									<th class="col-sm-1 center" id="thInfoValorTaxaGeraMensalidadeID"></th>
									<th class="col-sm-2 center" id="thInfoValorTotalGeraMensalidadeID"></th>
									<th class="col-sm-2 center"></th>
								</tr>
							</tfoot>
						</table>
					</div>
					<div class="row center">
						<ul class="pagination" id="pagerValoresGeraMensalidadeID">
						</ul>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="wizard-actions col-sm-2 pull-right" >
	
		<!-- #section:plugins/fuelux.wizard.buttons -->
		<button class="btn btn-app btn-sm btn-prev pull-left">
			Anterior
			<i class="ace-icon fa fa-arrow-left"></i>
		</button>
		<button id="btnProxgeraMensalidadeID" class="btn btn-app btn-sm btn-success btn-next pull-right" data-last="Finalizar">
			Próximo
			<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
		</button>
		<!-- /section:plugins/fuelux.wizard.buttons -->
	</div>
</div>

<div class="hidden" id="divInfoGeraMensalidadeID">
	<div class="widget-box">
		<div class="widget-header widget-header-flat widget-header-small center">
			<h5 class="widget-title">Informações</h5>
		</div>
		<div class="widget-body">
			<div class="widget-main small">
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Formandos:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;" id="lblNumFormadosSelID"></p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Meses até Conclusão:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;">%NUM_MESES_MAX% meses &nbsp;(%DATA_CONCLUSAO%)</p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor da Formatura:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;">%VALOR_TOTAL_FORM_FMT%</p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Total Por Formando:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;">%MENSALIDADE_FORMANDO_FMT%</p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Saldo a Provisionar:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;" id="lblSaldoProvisionarID"></p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Uso do SuaFormatura.com:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;">%TAXA_USO_FMT% (Total por Formando)</p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Taxa de emissão do Boleto:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;" id="lblTaxaBoletoID"></p>
			    	</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
				    	<p class="col-sm-5 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Taxa de Administração:</p>
				    	<p class="col-sm-7 pull-right align-left" style="padding: 2px; margin:0;">%TAXA_ADMIN_FMT%</p>
			    	</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>

$(document).one('ajaxloadstart.page', function(e) {
	//in ajax mode, remove remaining elements before leaving page
	$('[class*=select2]').remove();
});

$(".nav-tabs a[data-toggle=tab]").on("click", function(e) {
	if ($(this).hasClass("disabled")) {
		e.preventDefault();
		return false;
	}
});

/** Desabilitar os selects para a tela de View **/
$('[data-rel="select2"]').each(function( index ) {
	if ($(this).hasClass('readonly')) {
		$(this).select2("readonly", true);
	}else{
		$(this).select2({allowClear: true});
	}
});

$('[zg-data-toggle="mask"]').each(function( index ) {
	zgMask($( this ), $( this ).attr('zg-data-mask'));
});

$('[data-rel=tooltip]').tooltip();
$('[data-rel=popover]').popover({html:true});
$('[data-rel="select2"]').select2({allowClear: true});
$('.datepicker').datepicker({"autoclose": true});

$('textarea[class*=autosize]').autosize({append: "\n"});
$('textarea.limited').inputlimiter({
	remText: '%n caracteres restando...',
	limitText: 'Máximo Permitido : %n.'
});


$('#fuelux-wizard-container')
.ace_wizard({
	//step: 2 //optional argument. wizard will jump to step "2" at first
	//buttons: '.wizard-actions:eq(0)'
})
.on('actionclicked.fu.wizard' , function(e, info){
	if(info.step == 1) {
		
	}else if (info.step == 2) {
		var vOk 	= validaVencimentoGeraMensalidade();
		if(!vOk) 	{
			e.preventDefault();
		}
		mostraQuadroGeraMensalidade('divInfoValorID');
		
		/** sugere o saldo a provisionar no valor total da conta **/
		sugereValorGeraMensalidade();
		
	}else if (info.step == 3) {
		var vOk 	= validaValoresGeraMensalidade();
		if(!vOk) 	{
			e.preventDefault();
		}else{
			mostraQuadroGeraMensalidade('divInfoValorID');
			criaTabelaValoresGeraMensalidade();
		}
	}
})
.on('finished.fu.wizard', function(e) {
	var vOk 	= atualizaEValidaParcelasGeraMensalidade();
	if(!vOk) 	{
		$.gritter.add({
			title: 'Valores inconsistentes',
			text: 'Ajuste os valores das parcelas !!!!',
			class_name: 'gritter-info gritter-center gritter-error'
		});

		e.preventDefault();
		return false;
	}else{
		$('#zgFormGeraMensalidadeID').submit();
	}
	
}).on('stepclick.fu.wizard', function(e){
	//e.preventDefault();//this will prevent clicking and selecting steps
});








function desCadMostraQuadroResumo() {
	var vSaldoMensalidade	= zgConverteFloat($('#saldoMensalidadeFormandoID').val());
	var vSaldoSistema		= zgConverteFloat($('#saldoSistemaFormandoID').val());
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	/** Atualizar o quadro **/
	$('#lbInfoSaldoMensalidadeID').html(accounting.formatMoney(vSaldoMensalidade,$opt));
	$('#lbInfoSaldoSistemaID').html(accounting.formatMoney(vSaldoSistema,$opt));
	
	
	
	/**
	var $lblFor		= $('#numForSelID').val() + ' de  %TOTAL_FORMANDOS%';
	var $divInfo	= $('#divInfoGeraMensalidadeID').html();
	$('#'+$divId).html($divInfo);
	$('#lblNumFormadosSelID').each( function() {
		$(this).html($lblFor);
	});
	$('#lblSaldoProvisionarID').html(accounting.formatMoney($saldo,$opt) + " (por Formando)");
	**/
}

desCadCalculaValorTotalEvento();
function desCadCalculaValorTotalEvento() {
	var $saldoMensalidade	= zgConverteFloat($('#saldoMensalidadeFormandoID').val());
	var $saldoPortal		= zgConverteFloat($('#saldoPortalFormandoID').val());
	var $valorFormatura		= zgConverteFloat($('#valorFormaturaFormandoID').val());
	
	
	var $aSelEventos	= [];
	var $totalEventos	= 0;
	
	var $opt = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	$('input[name="codEventoSel[]"]:checked').each( function() {
		var $codEvento						= $(this).val();
		$aSelEventos[$aSelEventos.length]	= $codEvento;
		$input								= $('input[zg-codigo="'+$codEvento+'"]');
		$valorEvento						= zgConverteFloat($input.attr('zg-valor'));
		$totalEventos						+= $valorEvento;
	});
	
	/** Atualizar o quadro **/
	$('#lbInfoSaldoMensalidadeID').html(accounting.formatMoney($saldoMensalidade,$opt));
	$('#lbInfoSaldoPortalID').html(accounting.formatMoney($saldoPortal,$opt));
	$('#lbInfoValorFormaturaID').html(accounting.formatMoney($valorFormatura,$opt));
	
	
	// Atualiza total evento	
	$('#lbInfoTotalEventosID').html(accounting.formatMoney($totalEventos,$opt));
	
	//Atualiza total
	$total =  $saldoMensalidade - $totalEventos;
	
	if ($total < 0){
		$('#lbInfoSaldoID').html('<FONT SIZE="2"><b>'+accounting.formatMoney($total,$opt)+'</b></FONT>');
		$('#lbInfoSaldoTituloID').html('<FONT SIZE="2"><b>A PAGAR:</b></FONT>');
	}else{
		$('#lbInfoSaldoID').html('<FONT SIZE="2"><b>'+accounting.formatMoney($total,$opt)+'</b></FONT>');
		$('#lbInfoSaldoTituloID').html('<FONT SIZE="2"><b>A DEVOLVER:</b></FONT>');
	}
	
	
}


</script>