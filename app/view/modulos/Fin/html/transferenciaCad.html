<div id="content">
	<div class="page-header">
	<h1>Cadastro de Transferência entre contas</h1>
	</div><!-- /.page-header -->
	<br />

	<!-- #section:plugins/fuelux.wizard -->
	<div id="fuelux-wizard-container" class="col-sm-9 pull-left">
		<div>
			<!-- #section:plugins/fuelux.wizard.steps -->
			<ul class="steps" id='ulWizardTransfCadID'>
				<li data-step="1" class="active">
					<span class="step">1</span>
					<span class="title">Recorrência</span>
				</li>
				<li data-step="2" id='stepIdentTransfCadID'>
					<span class="step">2</span>
					<span class="title" id="stepIdentTransfCadTitleID">Identificação / Valor</span>
				</li>
				<li data-step="3" id='stepParcelasTransfCadID'>
					<span class="step">3</span>
					<span class="title" id="stepParcelasTransfCadTitleID">Parcelas</span>
				</li>
				<li data-step="4" id='stepConfigTransfCadID'>
					<span class="step">4</span>
					<span class="title">Configurações</span>
				</li>
			</ul>
		</div>
		<hr />
		<form id="zgFormID" class="form-horizontal">
			<input type="hidden" name="id" value="%ID%">
			<input type="hidden" id="numeroID" name="numero">
			<input type="hidden" id="codTransfID" name="codTransf">
			<input type="hidden" id="codStatusID" name="codStatus">
			<input type="hidden" id="parcelaID" name="parcela" value="1">
			<input type="hidden" id="codTipoValorID" name="codTipoValor">
			<input type="hidden" id="codTipoRecID" name="codTipoRec">
			<input type="hidden" id="flagAlterarSeqID" name="flagAlterarSeq">
			<input type="hidden" id="valorTotalID" name="valorTotal">
			
			<div class="step-content pos-rel">
				<div class="step-pane active" data-step="1">
					<div class="row ">
						<div class="form-group col-sm-12" id="divRecorrenciaID">
							<label class="col-sm-3 control-label">Recorrência</label>
							<div class="btn-group btn-corner col-sm-8 pull-left">
								<span id='codTipoRecUID' style="width: 180px;" class="btn btn-sm" onclick="selecionaContaUnicaTransfCad();">Única</span>
								<span tabindex="99001" class="btn btn-sm btn-info"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe se a conta será única ou parcelada"></i></span>
								<span id='codTipoRecPID' style="width: 180px;" class="btn btn-sm" onclick="selecionaContaParceladaTransfCad();">Parcelada</span>
							</div>
							<div class="help-block col-sm-1 inline" id="divHelpRecorrenciaID"></div>
						</div>
					</div>
					<div class="row " id="divRecParcelaID">
						<div class="form-group col-sm-12" id="divNumParcelasID">
							<label class="col-sm-3 control-label">Num. de Parcelas</label>
			    			<div class="input-group col-sm-3 pull-left">
			    				<div class="input-group col-sm-9 pull-left">
				    				<span tabindex="99001" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Número de parcelas"></i></span>
						    		<input class="form-control" id="numParcelasID" onchange="atualizaInfoValorTransfCad()" type="text" name="numParcelas"  maxlength="2" autocomplete="off" zg-data-toggle="mask" zg-data-mask="numero">
						    	</div>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpNumParcelasID"></div>
				    	</div>
						<div class="form-group col-sm-12" id="divParcelaInicialID">
							<label class="col-sm-3 control-label">Parcela Inicial</label>
			    			<div class="input-group col-sm-3 pull-left">
			    				<div class="input-group col-sm-9 pull-left">
				    				<span tabindex="99002" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Parcela inicial que será considerada (o número total de parcelas será: NUM_PARCELAS - PARCELA_INICIAL)"></i></span>
						    		<input class="form-control" id="parcelaInicialID" onchange="atualizaInfoValorTransfCad()" type="text" name="parcelaInicial" value="1" maxlength="2" autocomplete="off" zg-data-toggle="mask" zg-data-mask="numero">
						    	</div>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpParcelaInicialID"></div>
				    	</div>
						<div class="form-group col-sm-12" id="divPeriodoRecID">
							<label class="col-sm-3 control-label">Repete-se a cada</label>
			    			<div class="input-group col-sm-3 pull-left">
			    				<div class="input-group col-sm-10 pull-left">
				    				<span tabindex="99003" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Intervalo de repetição"></i></span>
				    				<input class="form-control" id="intervaloRecID" type="text" name="intervaloRec" maxlength="2" value="1" autocomplete="off" zg-data-toggle="mask" zg-data-mask="numero">
				    			</div>
				    		</div>
				    		<div class="input-group col-sm-2 pull-left">
				    			<div class="input-group col-sm-10 pull-left">
				    				<span tabindex="99004" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Período de Recorrência da Conta"></i></span>
									<select class="select2" style="width:100%;" id="codPeriodoRecID" name="codPeriodoRec" data-rel="select2">
									%PERIODOS_REC%
									</select>
								</div>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpPeriodoRecID"></div>
				    	</div>
					</div>
				</div>
				
				<div class="step-pane" data-step="2">
					<div class="row">
						<div class="form-group col-sm-12" id="divDescricaoID">
							<label class="col-sm-3 control-label">Descrição</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99005" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Descrição da Conta a Pagar"></i></span>
				    			<input class="form-control" id="descricaoID" type="text" name="descricao" maxlength="60" autocomplete="off">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpDescricaoID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divDataVencID">
							<label class="col-sm-3 control-label" id="lbTransfCadDataVencID"></label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99006" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Data de vencimento da conta"></i></span>
				    			<input class="form-control datepicker" id="dataVencID" type="text" name="dataVenc" onchange="atualizaInfoVencTransfCad();" maxlength="10" value="%DATA_VENC%" autocomplete="off" zg-data-toggle="mask" zg-data-mask="data">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpDataVencID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divIndValorParcelaID">
							<label class="col-sm-3 control-label">Valor se refere</label>
							<div class="btn-group btn-corner col-sm-8 pull-left">
								<span id='TransfCadValorParcelaID' style="width: 180px;" class="btn btn-sm" onclick="selecionaValorParcelaTransfCad();">Valor da Parcela</span>
								<span tabindex="99007" class="btn btn-sm btn-info"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Informe se o valor informado é o valor da Parcela, ou o valor total da conta"></i></span>
								<span id='TransfCadValorTotalID' style="width: 180px;" class="btn btn-sm" onclick="selecionaValorTotalTransfCad();">Valor Total</span>
							</div>
							
						</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divValorPID">
							<label class="col-sm-3 control-label">Valor</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99007" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Valor da conta"></i></span>
				    			<input onchange="atualizaInfoValorTransfCad()" class="form-control" id="valorPID" type="text" name="valorP" maxlength="20"  autocomplete="off" required zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpValorPID"></div>
				    	</div>
					</div>
				</div>
				<div class="step-pane" data-step="3.1">
					<div class="row">
						<div class="form-group col-sm-12" id="divValorUID">
							<label class="col-sm-3 control-label">Valor</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99007" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Valor da conta"></i></span>
				    			<input onchange="atualizaInfoValorTransfCad()" class="form-control" id="valorUID" type="text" name="valorU" maxlength="20"  autocomplete="off" required zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpValorUID"></div>
				    	</div>
					</div>
				</div>

				<div class="step-pane" data-step="3" id="divStepParcelasTransfCadID">
					<div class="row">
						<table id="transfCadTableValorID" class="paginated table table-condensed table-hover table-bordered bootstrap-datatable datatable display">
							<thead>
								<tr class="warning">
									<th class="col-sm-1 center" id="thInfoHelpTableParcelasTransfCadID"></th>
									<th class="col-sm-2 center">Parcela</th>
									<th class="col-sm-2 center">Valor</th>
									<th class="col-sm-2 center">Data</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
							<tfoot>
								<tr class="warning">
									<th class="col-sm-1 center"></th>
									<th class="col-sm-2 center" id="thInfoParcelaTransfCadID"></th>
									<th class="col-sm-2 center" id="thInfoValorTotalTransfCadID"></th>
									<th class="col-sm-2 center"></th>
								</tr>
							</tfoot>
						</table>
					</div>
					<div class="row center">
						<ul class="pagination" id="pagerValoresTransfCadID">
						</ul>
					</div>
				</div>

				<div class="step-pane" data-step="4" id="divStepConfigTransfCadID">
					<div class="row">
						<div class="form-group col-sm-12" id="divFormaPagID">
							<label class="col-sm-3 control-label">Forma de Pag.</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99011" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Selecione a Forma de Pagamento da Conta"></i></span>
								<select class="select2" style="width:100%;" id="codFormaPagID" name="codFormaPag" data-rel="select2" onchange="atualizaInfoFormaPagTransfCad();">
								%FORMAS_PAG%
								</select>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpFormaPagID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divContaOrigID">
							<label class="col-sm-3 control-label">Conta de Origem</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99012" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Conta de Pagamento (Conta que será debitado o valor)"></i></span>
								<select class="select2" style="width:100%;" id="codContaOrigID" name="codContaOrig" data-rel="select2" onchange="atualizaInfoContaOrigTransfCad();">
								%CONTAS%
								</select>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpContaOrigID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divContaDestID">
							<label class="col-sm-3 control-label">Conta de Destino</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99012" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Conta de Pagamento (Conta que será debitado o valor)"></i></span>
								<select class="select2" style="width:100%;" id="codContaDestID" name="codContaDest" data-rel="select2" onchange="atualizaInfoContaDestTransfCad();">
								%CONTAS%
								</select>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpContaDestID"></div>
				    	</div>
					</div>
					<div class="row hidden" id="divFlagRealizadaID">
						<div class="form-group col-sm-12" >
		    				<label class="col-sm-3 control-label">
		    					<input name="flagPaga" id="flagPagaID" class="ace ace-switch " value="1" type="checkbox" />
		    					<span class="lbl" data-lbl="SIM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NÃO">&nbsp;&nbsp;</span>
		    				</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99013" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Marque SIM para que a transferência já seja realizada (Confirmada)"></i></span>
			    				<input readonly type="text" class="form-control" placeholder="Transferência já realizada" aria-describedby="sizing-addon2" style="outline: none;  border-style: none none none solid !important;  -webkit-box-shadow: none !important;  -moz-box-shadow: none !important;  box-shadow: none !important;">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpFlagRealizadaID"></div>
				    	</div>
					</div>
					<div class="row hidden" id="divFlagConfirmarAutoID">
						<div class="form-group col-sm-12" >
		    				<label class="col-sm-3 control-label">
		    					<input name="flagPagarAuto" id="flagPagarAutoID" class="ace ace-switch " value="1" type="checkbox" />
		    					<span class="lbl" data-lbl="SIM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NÃO">&nbsp;&nbsp;</span>
		    				</label>
							
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99014" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Marque SIM para que o sistema faça confirme automática a transferência na data prevista"></i></span>
			    				<input readonly type="text" class="form-control" placeholder="Confirmar automaticamente na data" aria-describedby="sizing-addon2" style="outline: none;  border-style: none none none solid !important;  -webkit-box-shadow: none !important;  -moz-box-shadow: none !important;  box-shadow: none !important;">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpFlagConfirmarID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divDocumentoID">
							<label class="col-sm-3 control-label">Documento</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99018" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Documento (Você pode especificar algum documento relativo a conta)"></i></span>
			    				<input class="form-control" id="documentoID" type="text" name="documento" maxlength="20" autocomplete="off">
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpDocumentoID"></div>
				    	</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12" id="divObsID">
							<label class="col-sm-3 control-label">Observações</label>
			    			<div class="input-group col-sm-4 pull-left">
			    				<span tabindex="99018" class="input-group-addon"><i class="ace-icon fa fa-question-circle" data-rel="popover" data-placement="top" data-trigger="hover" data-original-title="<i class='ace-icon fa fa-question-circle red'></i> Ajuda" data-content="Observações adicionais"></i></span>
			    				<textarea class="form-control limited" id="obsID" maxlength="400" name="obs" autocomplete="off"></textarea>
						    </div>
							<div class="help-block col-sm-1 inline" id="divHelpObsID"></div>
				    	</div>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="col-sm-3 pull-right">
		<div class="widget-box">
			<div class="widget-header widget-header-flat widget-header-small center">
				<h5 class="widget-title">Resumo</h5>
			</div>
			<div class="widget-body">
				<div class="widget-main small">
					<div class="row hidden" id="divInfoIdentID">
						<h6 class="header widget-header widget-header-small blue bolder smaller">&nbsp;Identificação / Tipo</h6>
						<div class="vspace-xs"></div>
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Identificação:</p>
					    	<p id='lbInfoIdentID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoTipoContaID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Tipo:</p>
					    	<p id='lbInfoTipoContaID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoRecorrenciaID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Período:</p>
					    	<p id='lbInfoRecorrenciaID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoNumParcelasID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Parcelas:</p>
					    	<p id='lbInfoNumParcelasID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>

					<div class="row hidden" id="divInfoValorID">
						<h6 class="header widget-header widget-header-small blue bolder smaller">&nbsp;Valores / Vencimento</h6>
						<div class="vspace-xs"></div>
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Valor Total:</p>
					    	<p id='lbInfoValorID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoDataVencID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Vencimento:</p>
					    	<p id='lbInfoDataVencID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoConfID">
						<h6 class="header widget-header widget-header-small blue bolder smaller">&nbsp;Configurações</h6>
						<div class="vspace-xs"></div>
					</div>
					<div class="row hidden" id="divInfoFormaPagID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Forma Pag:</p>
					    	<p id='lbInfoFormaPagID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoContaOrigID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Conta Orig</p>
					    	<p id='lbInfoContaOrigID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoSaldoContaOrigID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Saldo Orig:</p>
					    	<p id='lbInfoSaldoContaOrigID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoContaDestID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Conta Dest</p>
					    	<p id='lbInfoContaDestID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
					<div class="row hidden" id="divInfoSaldoContaDestID">
						<div class="col-sm-12">
					    	<p class="col-sm-4 pull-left align-right text-info inline" style="padding: 2px; margin:0;">Saldo Dest:</p>
					    	<p id='lbInfoSaldoContaDestID' class="col-sm-8 pull-right align-left" style="padding: 2px; margin:0;"></p>
				    	</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="wizard-actions col-sm-9 pull-left" >
		<hr />
		<!-- #section:plugins/fuelux.wizard.buttons -->
		<button class="btn btn-prev">
			<i class="ace-icon fa fa-arrow-left"></i>
			Anterior
		</button>
		<button class="btn btn-success btn-next" data-last="Finalizar">
			Próximo
			<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
		</button>
		<!-- /section:plugins/fuelux.wizard.buttons -->
	</div>
</div>
<script>

$( document ).ready(function() {
	criaWizard();
	mostraDivRecParcelaTransfCad();
	selecionaValorParcelaTransfCad();
	selecionaContaUnicaTransfCad();
});

$(document).one('ajaxloadstart.page', function(e) {
	//in ajax mode, remove remaining elements before leaving page
	$('[class*=select2]').remove();
});

$(".nav-tabs a[data-toggle=tab]").on("click", function(e) {
	if ($(this).hasClass("disabled")) {
		e.preventDefault();
		return false;
	}
});

/** Desabilitar os selects para a tela de View **/
$('[data-rel="select2"]').each(function( index ) {
	if ($(this).hasClass('readonly')) {
		$(this).select2("readonly", true);
	}else{
		$(this).select2({allowClear: true});
	}
});

$('[zg-data-toggle="mask"]').each(function( index ) {
	zgMask($( this ), $( this ).attr('zg-data-mask'));
});

$('[data-rel=tooltip]').tooltip();
$('[data-rel=popover]').popover({html:true});
$('[data-rel="select2"]').select2({allowClear: true});
$('.datepicker').datepicker({"autoclose": true});

$('textarea[class*=autosize]').autosize({append: "\n"});
$('textarea.limited').inputlimiter({
	remText: '%n caracteres restando...',
	limitText: 'Máximo Permitido : %n.'
});

function paginateTableValoresTranfCad() {
	$('#pagerValoresTransfCadID li').remove();

	$('table.paginated').each(function() {
	    var currentPage = 0;
	    var numPerPage 	= 5;
	    var $table = $(this);
	    $table.bind('repaginate', function() {
	        $table.find('tbody tr').hide().slice(currentPage * numPerPage, (currentPage + 1) * numPerPage).show();
	    });
	    $table.trigger('repaginate');
	    var numRows = $table.find('tbody tr').length;
	    var numPages = Math.ceil(numRows / numPerPage);
	    var $pager = $('#pagerValoresTransfCadID');
	    for (var page = 0; page < numPages; page++) {
	    	$('<li><a href="#"><span class="page-number">'+(page + 1)+'</span></a></li>').bind('click', {
	        //$('<span class="page-number"></span>').text(page + 1).bind('click', {
	            newPage: page
	        }, function(event) {
	            currentPage = event.data['newPage'];
	            $table.trigger('repaginate');
	            $(this).addClass('active').siblings().removeClass('active');
	        }).appendTo($pager).addClass('clickable');
	    }
	    $pager.insertBefore($table).find('span.page-number:first').addClass('active');
	});
}

function criaWizard() {

	$('#fuelux-wizard-container')
	.ace_wizard({
		//step: 2 //optional argument. wizard will jump to step "2" at first
		//buttons: '.wizard-actions:eq(0)'
	})
	.on('actionclicked.fu.wizard' , function(e, info){
		if(info.step == 1) {
			var vOk 	= validaRecorrenciaTransfCad();
			if (!vOk) 	{
				e.preventDefault();
			}else{
				atualizaInfoRecorrenciaTransfCad();
			}
			
		}else if (info.step == 2) {
			var $tipoRecParc		= $('#codTipoRecID').val();
			var vOk1 	= validaIdentificacaoTransfCad();
			
			if ($tipoRecParc == "P") {
				var vOk2 	= validaValoresTransfCad();
			}else{
				var vOk2 	= true;
			}
			
			if ( (!vOk1) || (!vOk2) ) 	{
				e.preventDefault();
			}else{
				atualizaInfoIdentTransfCad();
				atualizaInfoValorTransfCad();
				atualizaInfoVencTransfCad();
				criaTabelaValoresTransfCad();
			}
		}else if (info.step == 3) {
			var $tipoRecParc		= $('#codTipoRecID').val();
			if ($tipoRecParc == "P") {
				var vOk 	= atualizaEValidaParcelasTransfCad();
				if(!vOk) 	{
					e.preventDefault();
				}
			}else{
				var vOk 	= validaValoresTransfCad();
				if(!vOk) 	{
					e.preventDefault();
				}else{
					atualizaInfoValorTransfCad();
					criaTabelaValoresTransfCad();
				}
			}
			atualizaDivPagaTransfCad();
		}else if (info.step == 4) {
			var vOk 	= validaConfiguracoesTransfCad();
			if(!vOk) 	{
				e.preventDefault();
			}
		}
		
	})
	.on('finished.fu.wizard', function(e) {
		var vOk 	= validaConfiguracoesTransfCad();
		if(!vOk) 	{
			e.preventDefault();
			return false;
		}else{
			$('#zgFormID').submit();
		}
		
	}).on('stepclick.fu.wizard', function(e){
		//e.preventDefault();//this will prevent clicking and selecting steps
	});
}


$('#zgFormID').submit(function() {
	/** Retirar a máscara para os campos que estão configurados para tal **/
	$('[zg-data-mask-retira="1"]').each(function( index ) {
		$( this ).val($( this ).cleanVal());
	});

	/** Habilitar os SELECTS que estão desabilitados para poder enviar o valor **/
	$( "select" ).each(function( index ) {
		if ($(this).hasClass('readonly')) {
			$(this).prop( "disabled", false );
		}
	});

	$.ajax({
		type:	"POST", 
		url:	"%DP%",
		data:	$('#zgFormID').serialize(),
	}).done(function( data, textStatus, jqXHR) {
		/** Recolocar a máscara para os campos que estão configurados para tal **/
		$('[zg-data-mask-retira="1"]').each(function( index ) {
			zgMask($( this ), $( this ).attr('zg-data-mask'));
			$( this ).trigger('keyup');
		});
		
		if (checaRetornoOK(data) == true) {
			bootbox.dialog({
				message: "Conta salva com sucesso !!!", 
				buttons: {
					"novo" : {
						"label" : "<i class='ace-icon fa fa-plus'></i>Cadastrar nova transferência",
						"className" : "btn-sm btn-primary",
						"callback": function() {
							zgLoadUrl('%URL_ADD%');
						}
					},
					"fechar" : {
						"label" : "<i class='ace-icon fa fa-close'></i>Fechar",
						"className" : "btn-sm btn-danger",
						"callback": function() {
							zgLoadUrl('%URL_VOLTAR%');
						}

					},
					
				}
			});
		}else{
			zgMostraAviso("Fechar");
		}
	}).fail(function( jqXHR, textStatus, errorThrown) {
		zgMostraAviso("Fechar");
	});
	return false; 
});

var timer;

function recalculaStepsTransfCad() {
	var	$ul					= $('#ulWizardTransfCadID');
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $vIndex				= 3;
	
	//$('#stepParcelasTransfCadID').remove();
	//$('#stepConfigTransfCadID').remove();
	
	if ($tipoRecParc == "P") {
		//$ul.append('<li data-step="3" id="stepParcelasTransfCadID"><span class="step">3</span><span class="title">Parcelas</span></li><li data-step="4" id="stepConfigTransfCadID"><span class="step">4</span><span class="title">Configurações</span></li>');
		$('#stepParcelasTransfCadID').attr("data-step",3);
		//$('#divStepConfigTransfCadID').attr("data-step",4);
		$('#stepIdentTransfCadTitleID').html("Identificação / Valor");
		$('#stepParcelasTransfCadTitleID').html("Parcelas");
	}else{
		//$ul.append('<li data-step="3.1" id="stepParcelasTransfCadID"><span class="step">3</span><span class="title">Valor</span></li><li data-step="4" id="stepConfigTransfCadID"><span class="step">4</span><span class="title">Configurações</span></li>');
		//$ul.append('<li data-step="3" id="stepConfigTransfCadID"><span class="step">3</span><span class="title">Configurações</span></li>');
		$('#stepParcelasTransfCadID').attr("data-step","3.1");
		//$('#divStepConfigTransfCadID').attr("data-step",4);
		//$('#divStepParcelasTransfCadID').removeAttr("data-step");
		//$('#divStepConfigTransfCadID').attr("data-step",3);
		$('#stepIdentTransfCadTitleID').html("Identificação");
		$('#stepParcelasTransfCadTitleID').html("Valor");	
	}
}

function criaTabelaValoresTransfCad() {
	var $table				= $('#transfCadTableValorID');
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $codTipoValor		= $('#codTipoValorID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $codPeriodoRec		= $('#codPeriodoRecID').val();
	var $intervaloRec		= parseInt($('#intervaloRecID').val());
	var $dataVenc			= $('#dataVencID').val();
	var $tipo,$parcelas;
	var $nValor,$valor,$valorParcela,$valorTotal,$datas;

	var options = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
		
	var optTotal = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};


	$valorParcela	= accounting.formatMoney(getValorParcelaTransfCad(),options);
	$valorTotal		= accounting.formatMoney(getValorTotalTransfCad(),optTotal);
	$parcelas		= getNumParcelasTransfCad();	
	
	/** Resgata as datas de vencimentos **/
	jQuery.ajax({
		url: "%ROOT_URL%/Fin/geraDatasVencimentoConta.dp.php",
		data: { dataVenc: $dataVenc, codPeriodoRec: $codPeriodoRec, intervaloRec: $intervaloRec, numParcelas: $parcelas},
		success: function(ret) {
			$datas	= JSON.parse(ret);
		},
		method: 'get',
		cache: false,
		async:false
	});

	/** Remove os dados atuais **/
	$('#transfCadTableValorID > tbody').find('tr').remove();
	
	for ($i = 0; $i < $parcelas; $i++) {
		var $descParcela	= ($i+1) + " / " + $parcelas;
		if ($i == ($parcelas -1)) {
			var $_parc	= accounting.formatMoney(getValorTotalTransfCad() - (getValorParcelaTransfCad() * ($parcelas -1) ),options);
		}else{
			var $_parc 	= $valorParcela;
		}
		
		$('#transfCadTableValorID > tbody:last').append('<tr><td class="center" style="width: 20px;"><div class="inline" zg-type="zg-div-msg"></div></td><td class="center" style="width: 40px;">'+$descParcela+'</td><td style="width: 120px;"><input type="text" class="form-control input-sm" name="aValor[]" value="'+$_parc+'" onchange="atualizaEValidaParcelasTransfCad();" maxlength="20" autocomplete="off" zg-data-toggle="mask" zg-data-mask="dinheiro" zg-data-mask-retira="0"></td><td style="width: 120px;"><input type="text" class="form-control input-sm datepicker" name="aData[]" value="'+$datas[$i].dataVenc+'" onchange="atualizaEValidaParcelasTransfCad();" maxlength="10" autocomplete="off" zg-data-toggle="mask" zg-data-mask="data"></td></tr>');		

		$('#transfCadTableValorID > tbody > tr:last [zg-data-toggle="mask"]').each(function( index ) {
			zgMask($( this ), $( this ).attr('zg-data-mask'));
			$( this ).trigger('keyup');
		});
		
		$('#transfCadTableValorID > tbody > tr:last .datepicker').each(function( index ) {
			$(this).datepicker({"autoclose": true});
		});
		
	}

	$('#thInfoValorTotalTransfCadID').html($valorTotal);
	$('#thInfoParcelaTransfCadID').html($parcelas);
	atualizaEValidaParcelasTransfCad();
	paginateTableValoresTranfCad();
}

function selecionaContaUnicaTransfCad() {
	$('#codTipoRecUID').addClass("btn-primary");
	$('#codTipoRecUID').removeClass("btn-light");
	$('#codTipoRecPID').addClass("btn-light");
	$('#codTipoRecPID').removeClass("btn-primary");
	$('#codTipoRecID').val("U");
	mostraDivRecParcelaTransfCad();
	atualizaLabelVencTransfCad();
	recalculaStepsTransfCad();
}

function selecionaContaParceladaTransfCad() {
	$('#codTipoRecPID').addClass("btn-primary");
	$('#codTipoRecPID').removeClass("btn-light");
	$('#codTipoRecUID').addClass("btn-light");
	$('#codTipoRecUID').removeClass("btn-primary");
	$('#codTipoRecID').val("P");
	mostraDivRecParcelaTransfCad();
	atualizaLabelVencTransfCad();
	recalculaStepsTransfCad();
}

function selecionaValorParcelaTransfCad() {
	$('#TransfCadValorParcelaID').addClass("btn-primary");
	$('#TransfCadValorParcelaID').removeClass("btn-light");
	$('#TransfCadValorTotalID').addClass("btn-light");
	$('#TransfCadValorTotalID').removeClass("btn-primary");
	$('#codTipoValorID').val("P");
	atualizaInfoValorTransfCad();
}

function selecionaValorTotalTransfCad() {
	$('#TransfCadValorTotalID').addClass("btn-primary");
	$('#TransfCadValorTotalID').removeClass("btn-light");
	$('#TransfCadValorParcelaID').addClass("btn-light");
	$('#TransfCadValorParcelaID').removeClass("btn-primary");
	$('#codTipoValorID').val("T");
	atualizaInfoValorTransfCad();
}

function mostraDivRecParcelaTransfCad() {
	var vTipoRec 		= $('#codTipoRecID').val();
	
	if (vTipoRec 	== 'U') {
		$('#divRecParcelaID').hide();
	}else if (vTipoRec 	== 'P') {
		$('#divRecParcelaID').show();
	}else{
		$('#divRecParcelaID').hide();
	}
	
}


function validaRecorrenciaTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $codPeriodoRec		= $('#codPeriodoRecID').val();
	var $intervaloRec		= parseInt($('#intervaloRecID').val());
	var vOK					= true;
	
	if ($tipoRecParc	== 'P') {
		
		$('#divNumParcelasID').removeClass('has-error');
		$('#divParcelaInicialID').removeClass('has-error');
		$('#divPeriodoRecID').removeClass('has-error');
		
		$('#divHelpNumParcelasID').html('');
		$('#divHelpParcelaInicialID').html('');
		$('#divHelpPeriodoRecID').html('');

		
		if ( (!$numParcelas) || ($numParcelas <= 1)) {
			$('#divNumParcelasID').addClass('has-error');
			$('#divHelpNumParcelasID').html(zgCriaSpanErro('Número de parcelas deve ser preenchido com um número maior que 1'));
			vOK			= false;
		}else if ( ($codPeriodoRec == "D") && ($numParcelas > 365) ) {
			$('#divNumParcelasID').addClass('has-error');
			$('#divHelpNumParcelasID').html(zgCriaSpanErro('Número de parcelas deve ser menor ou igual a 365 para o tipo de recorrência Diário'));
			vOK			= false;
		}else if ( ($codPeriodoRec == "S") && ($numParcelas > 54) ) {
			$('#divNumParcelasID').addClass('has-error');
			$('#divHelpNumParcelasID').html(zgCriaSpanErro('Número de parcelas deve ser menor ou igual a 38 para o tipo de recorrência Semanal'));
			vOK			= false;
		}else if ( ($codPeriodoRec == "M") && ($numParcelas > 120) ) {
			$('#divNumParcelasID').addClass('has-error');
			$('#divHelpNumParcelasID').html(zgCriaSpanErro('Número de parcelas deve ser menor ou igual a 120 para o tipo de recorrência Mensal'));
			vOK			= false;
		}else if ( ($codPeriodoRec == "A") && ($numParcelas > 10) ) {
			$('#divNumParcelasID').addClass('has-error');
			$('#divHelpNumParcelasID').html(zgCriaSpanErro('Número de parcelas deve ser menor ou igual a 10 para o tipo de recorrência Anual'));
			vOK			= false;
		}

		if (!$parcelaInicial) {
			$('#divParcelaInicialID').addClass('has-error');
			$('#divHelpParcelaInicialID').html(zgCriaSpanErro('Parcela Inicial deve ser Preenchido com um número maior que 0'));
			vOK			= false;
		}else if ($parcelaInicial > $numParcelas) {
			$('#divParcelaInicialID').addClass('has-error');
			$('#divHelpParcelaInicialID').html(zgCriaSpanErro('Parcela Inicial deve ser menor que Número de parcelas'));
			vOK			= false;
		}
		
		if (!$intervaloRec) {
			$('#divPeriodoRecID').addClass('has-error');
			$('#divHelpPeriodoRecID').html(zgCriaSpanErro('Intervalo de repetição deve ser preenchido com um número maior que 0'));
			vOK			= false;
		}

	}
	
	atualizaInfoValorTransfCad();
	
	return vOK;

}

function validaIdentificacaoTransfCad() {
	var $descricao		= $('#descricaoID').val();
	var $dataVenc		= $('#dataVencID').val();
	var vOK				= true;
	
	$('#divDescricaoID').removeClass('has-error');
	$('#divDataVencID').removeClass('has-error');
		
	$('#divHelpDescricaoID').html('');
	$('#divHelpDataVencID').html('');

	if (!$descricao) {
		$('#divDescricaoID').addClass('has-error');
		$('#divHelpDescricaoID').html(zgCriaSpanErro('Descriçao deve ser preenchida !!'));
		vOK			= false;
	}else if ($descricao.length > 60) {
		$('#divDescricaoID').addClass('has-error');
		$('#divHelpDescricaoID').html(zgCriaSpanErro('Descrição deve conter no máximo 60 caracteres'));
		vOK			= false;
	}else if ($descricao.length < 2) {
		$('#divDescricaoID').addClass('has-error');
		$('#divHelpDescricaoID').html(zgCriaSpanErro('Descrição deve conter no mínimo 2 caracteres'));
		vOK			= false;
	}

	
	if (!$dataVenc) {
		$('#divDataVencID').addClass('has-error');
		$('#divHelpDataVencID').html(zgCriaSpanErro('Data de Vencimento deve ser preenchida !!'));
		vOK			= false;
	}else if (isDataBR($dataVenc) == false) {
		$('#divDataVencID').addClass('has-error');
		$('#divHelpDataVencID').html(zgCriaSpanErro('Data de Vencimento inválida !!'));
		vOK			= false;
	}

	return vOK;

}

function validaValoresTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var vOK					= true;
	
	if ($tipoRecParc		== "P") {
		var $valor			= $('#valorPID').val();
		var $helpID			= "divHelpValorPID";
		var $divID			= "divValorPID";
	}else{
		var $valor			= $('#valorUID').val();
		var $helpID			= "divHelpValorUID";
		var $divID			= "divValorUID";
	}
	
	
	$('#'+$divID).removeClass('has-error');
	$('#'+$helpID).html('');
	
	if (!$valor) {
		$('#'+$divID).addClass('has-error');
		$('#'+$helpID).html(zgCriaSpanErro('Valor deve ser preenchido !!'));
		vOK			= false;
	}else if ($valor == 0) {
		$('#'+$divID).addClass('has-error');
		$('#'+$helpID).html(zgCriaSpanErro('Valor deve ser maior que 0'));
		vOK			= false;
	}else if (isMoney($valor) == false) {
		$('#'+$divID).addClass('has-error');
		$('#'+$helpID).html(zgCriaSpanErro('Valor deve ser numérico'));
		vOK			= false;
	}
	
	return vOK;

}

function atualizaEValidaParcelasTransfCad() {
	var $tValor 	= parseFloat(0);
	var $total		= getValorTotalTransfCad();
	var $cem		= (100+0).toFixed(2);
	var $htmlOK,$htmlError,$htmlValor,$htmlPct,$vOK;
	var $epsilon	= 0.00000001;
	var $vOK;
	var $menorData;
	
	$vOK			= true;

	$('#transfCadTableValorID > tbody > tr [name*="aValor[]"]').each(function( index ) {
		$tValor += parseFloat($(this).val().replace(".", "").replace(",","."));
	});
	
	$tValor		= parseFloat($tValor.toFixed(2));
	
	var opt = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};

	var opt1 = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	var opt2 = {
		symbol : "",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	//alert("Valor informado: "+$total+" Valor calculado: "+$tValor);
	/** Valida os valores **/
	if ($tValor != $total) {
		var $textoValor;
		var	$diffValor	= ($total - $tValor);
		
		if ($diffValor > 0) {
			$textoValor	= "Falta ainda: "+accounting.formatMoney($diffValor, opt1);
		}else{
			$textoValor	= "Valor está a maior: "+accounting.formatMoney(($diffValor*-1), opt1);
		}
		
		$htmlError	= zgCriaSpanErro($textoValor);
		$vOK		= false;
	}
	
	
	if (!$vOK) {
		$('#thInfoHelpTableParcelasTransfCadID').html($htmlError);
		return $vOK;
	}
	

	/** Valida Data **/
	$('#transfCadTableValorID > tbody > tr [name*="aData[]"]').each(function( index ) {
		var $td		= $(this).parent();
		var $tr		= $td.parent();

		if (index == 0) {
			$menorData = moment($(this).val(), "%FORMATO_DATA%");
			$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanOK());
		}else{
			var $data	= moment($(this).val(), "%FORMATO_DATA%");
			var $dif	= $data - $menorData; 
			
			if ($dif < 0) {
				$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanErro("Data deve ser maior do que a parcela anterior"));
				$tr.addClass("alert-danger");
				$vOK	= false;
			}else{
				$tr.find('[zg-type="zg-div-msg"]').html(zgCriaSpanOK());
				$tr.removeClass("alert-danger");
			}
			$menorData = moment($(this).val(), "%FORMATO_DATA%");
		}
	});

	if (!$vOK) {
		$('#thInfoHelpTableParcelasTransfCadID').html(zgCriaSpanErro("Verifique as datas dos registros marcados"));
		return $vOK;
	}else{
		$('#thInfoHelpTableParcelasTransfCadID').html(zgCriaSpanOK());
		return $vOK; 
	}
	
}


function validaConfiguracoesTransfCad() {
	var $codFormaPag	= $("#codFormaPagID option:selected").val();
	var $codContaOrig	= $("#codContaOrigID option:selected").val();
	var $codContaDest	= $("#codContaDestID option:selected").val();
	
	var vOK				= true;
	
	$('#divFormaPagID').removeClass('has-error');
	$('#divContaOrigID').removeClass('has-error');
	$('#divContaDestID').removeClass('has-error');
		
	$('#divHelpFormaPagID').html('');
	$('#divHelpContaOrigID').html('');
	$('#divHelpContaDestID').html('');
	
	if (!$codFormaPag) {
		$('#divFormaPagID').addClass('has-error');
		$('#divHelpFormaPagID').html(zgCriaSpanErro('Forma de pagamento deve ser selecionada !!'));
		vOK			= false;
	}

	if (!$codContaOrig) {
		$('#divContaOrigID').addClass('has-error');
		$('#divHelpContaOrigID').html(zgCriaSpanErro('Conta de origem deve ser selecionada !!'));
		vOK			= false;
	}

	if (!$codContaDest) {
		$('#divContaDestID').addClass('has-error');
		$('#divHelpContaDestID').html(zgCriaSpanErro('Conta de destino deve ser selecionada !!'));
		vOK			= false;
	}

	if ($codContaDest && ($codContaDest == $codContaOrig)) {
		$('#divContaDestID').addClass('has-error');
		$('#divHelpContaDestID').html(zgCriaSpanErro('Conta de destino deve ser diferente da origem !!'));
		vOK			= false;
	}

	return vOK;
}



function atualizaInfoRecorrenciaTransfCad() {
	var $tipoRecParc	= $('#codTipoRecID').val();
	var $numParcelas	= parseInt($('#numParcelasID').val());
	var $parcelaInicial	= parseInt($('#parcelaInicialID').val());
	var $codPeriodoRec	= $("#codPeriodoRecID option:selected").text();
	var $tipo,$parcelas;
	
	if ($tipoRecParc	== 'P') {
		$tipo			= "Parcelada";
		$parcelas		= $numParcelas - ($parcelaInicial - 1);
		
		$('#lbInfoRecorrenciaID').text($codPeriodoRec);
		$('#lbInfoNumParcelasID').text($parcelas);
		
		
		$('#divInfoRecorrenciaID').removeClass('hidden');
		$('#divInfoNumParcelasID').removeClass('hidden');
		
	}else{
		$tipo			= "Fixa";
		
		$('#divInfoRecorrenciaID').addClass('hidden');
		$('#divInfoNumParcelasID').addClass('hidden');

	}
	
	$('#lbInfoTipoContaID').text($tipo);
	$('#divInfoTipoContaID').removeClass('hidden');
	
}

function atualizaInfoIdentTransfCad() {
	var $ident		= $('#descricaoID').val();
	
	$('#lbInfoIdentID').text($ident);
	$('#divInfoIdentID').removeClass('hidden');
}

function atualizaInfoVencTransfCad() {
	var $venc		= $('#dataVencID').val();
	
	$('#lbInfoDataVencID').text($venc);
	$('#divInfoDataVencID').removeClass('hidden');
}

function atualizaLabelVencTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	
	if ($tipoRecParc	== 'P') {
		$('#lbTransfCadDataVencID').html("Data da 1&ordm; transferência");		
	}else{
		$('#lbTransfCadDataVencID').html("Data da transferência");
	}
	
}

function getValorParcelaTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $codTipoValor		= $('#codTipoValorID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $tipo,$parcelas;
	var $nValor,$valor,$valorJuros,$valorMora,$valorDesc,$valorParcela;
	
	if ($tipoRecParc	== 'P') {
		$valor			= parseFloat($('#valorPID').val().replace(".", "").replace(",","."));
	}else{
		$valor			= parseFloat($('#valorUID').val().replace(".", "").replace(",","."));
	}
	
	if (isNaN($valor))		$valor		= 0;
	
	$nValor			= $valor.toFixed(2);

	if ($tipoRecParc	== 'P') {
		var $parcelas	= $numParcelas - ($parcelaInicial -1);
		
		if ($codTipoValor == 'T') {
			$nValor		= ($nValor / $parcelas).toFixed(2);
		}
	}

	return ($nValor);
}

function getValorTotalTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $codTipoValor		= $('#codTipoValorID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $tipo,$parcelas;
	var $nValor,$valor,$valorJuros,$valorMora,$valorDesc,$valorParcela;
	
	if ($tipoRecParc	== 'P') {
		$valor			= parseFloat($('#valorPID').val().replace(".", "").replace(",","."));
	}else{
		$valor			= parseFloat($('#valorUID').val().replace(".", "").replace(",","."));
	}
	
	
	if (isNaN($valor))		$valor		= 0;
	
	$nValor			= $valor.toFixed(2);

	if ($tipoRecParc	== 'P') {
		var $parcelas	= $numParcelas - ($parcelaInicial -1);
		
		if ($codTipoValor == 'P') {
			$nValor		= ($nValor * $parcelas).toFixed(2);
		}
	}

	return ($nValor);
	
	
}

function getNumParcelasTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $codTipoValor		= $('#codTipoValorID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $tipo,$parcelas;
	
	if ($tipoRecParc	== 'P') {
		var $parcelas	= $numParcelas - ($parcelaInicial -1);
	}else{
		$parcelas	= 1;
	}

	return ($parcelas);
}


function atualizaInfoValorTransfCad() {
	var $tipoRecParc		= $('#codTipoRecID').val();
	var $codTipoValor		= $('#codTipoValorID').val();
	var $numParcelas		= parseInt($('#numParcelasID').val());
	var $parcelaInicial		= parseInt($('#parcelaInicialID').val());
	var $codPeriodoRec		= $('#codPeriodoRecID').val();
	var $tipo,$parcelas;
	var $nValor,$valor,$valorParcela;
	
	var options = {
		symbol : "R$ ",
		decimal : ",",
		thousand: ".",
		precision : 2,
		format: "%s%v"
	};
	
	if ($tipoRecParc	== 'P') {
		$valor			= parseFloat($('#valorPID').val().replace(".", "").replace(",","."));
	}else{
		$valor			= parseFloat($('#valorUID').val().replace(".", "").replace(",","."));
	}
	
	if (isNaN($valor))		$valor		= 0;
	
	$nValor			= $valor.toFixed(2);

	if ($tipoRecParc	== 'P') {
		$('#divIndValorParcelaID').removeClass('hidden');
		$('#divValorPID').removeClass('hidden');
		
		if (!$valor) return null;
		
		var $parcelas	= $numParcelas - ($parcelaInicial -1);
		
		if ($codTipoValor == 'P') {
			$nValor			= ($parcelas * $valor).toFixed(2);
			$nValor			= accounting.formatMoney($nValor, options);
		}else{
			
			$valorParcela			= ($nValor / $parcelas).toFixed(2);

			if (parseFloat(($valorParcela * $parcelas).toFixed(2)) != parseFloat($nValor)) {
				var $dif;
				
				$dif			= parseFloat((($valorParcela * $parcelas) - $nValor).toFixed(2));
				$nValor			= accounting.formatMoney($nValor, options);
				
			}else{
				$valorParcela	= accounting.formatMoney($valorParcela, options);
				$nValor			= accounting.formatMoney($nValor, options);
			}
		}
	}else{
		$('#divIndValorParcelaID').addClass('hidden');
		$('#divValorPID').addClass('hidden');

		if (!$valor) return null;
	}
	
	$('#valorTotalID').val(getValorTotalTransfCad());
	$('#lbInfoValorID').html($nValor);
	$('#divInfoValorID').removeClass('hidden');

}

function atualizaDivPagaTransfCad() {
	var $oHoje,$oVencIni,$oVencFim;
	var $aData			= $('[name*="aData\\[\\]"]');
	var $tipoRecParc	= $('#codTipoRecID').val();
	
	var $vencIni		= $aData.first().val();
	var $vencFim		= $aData.last().val();
	
	$oHoje		= moment();
	$oVencIni	= moment($vencIni, "%FORMATO_DATA%");
	$oVencFim	= moment($vencFim, "%FORMATO_DATA%");
	
	//$oHoje.setHours(0,0,0,0);
	//$oVencIni.setHours(0,0,0,0);
	//$oVencFim.setHours(0,0,0,0);
	
	$('#divFlagConfirmarAutoID').addClass('hidden');
	$('#divFlagRealizadaID').addClass('hidden');
	
	if ($tipoRecParc	== 'P') {
		if ($oVencIni <= $oHoje) {
			$('#divFlagRealizadaID').removeClass('hidden');
		}

		if ($oVencFim > $oHoje) {
			$('#divFlagConfirmarAutoID').removeClass('hidden');
		}
		
	}else{
		if ($oVencIni > $oHoje) {
			$('#divFlagConfirmarAutoID').removeClass('hidden');
		}else{
			$('#divFlagRealizadaID').removeClass('hidden');
		}
	}
}

function atualizaInfoFormaPagTransfCad() {
	var $desc	= $("#codFormaPagID option:selected").text();
	if ($desc)	{
		$('#lbInfoFormaPagID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoFormaPagID').removeClass('hidden');
	}
}

function atualizaInfoContaOrigTransfCad() {
	var $desc	= $("#codContaOrigID option:selected").text();
	
	var options = {
			symbol : "R$ ",
			decimal : ",",
			thousand: ".",
			precision : 2,
			format: "%s%v"
	};
	
	if ($desc)	{
		$('#lbInfoContaOrigID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoContaOrigID').removeClass('hidden');
		
		$.ajax({
			url: "%ROOT_URL%/Fin/getSaldoConta.dp.php",
			data:  { codConta: $('#codContaOrigID').val()},
			success: function(data) {
				var $saldo	= data["saldo"];
				var $desc;
				
				if ($saldo > 0) {
					$desc	= "<span class='text-success'>"+accounting.formatMoney($saldo, options)+"</span>";
				}else{
					$desc	= "<strong>(&nbsp;<span class='text-danger'>"+accounting.formatMoney($saldo, options)+"</span>&nbsp;)</strong>";
				}
				
				$('#lbInfoSaldoContaOrigID').html($desc);
				$('#divInfoSaldoContaOrigID').removeClass('hidden');
		    },
			dataType: 'json'
		});
	}
}

function atualizaInfoContaDestTransfCad() {
	var $desc	= $("#codContaDestID option:selected").text();
	
	var options = {
			symbol : "R$ ",
			decimal : ",",
			thousand: ".",
			precision : 2,
			format: "%s%v"
	};
	
	if ($desc)	{
		$('#lbInfoContaDestID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoContaDestID').removeClass('hidden');
		
		$.ajax({
			url: "%ROOT_URL%/Fin/getSaldoConta.dp.php",
			data:  { codConta: $('#codContaDestID').val()},
			success: function(data) {
				var $saldo	= data["saldo"];
				var $desc;
				
				if ($saldo > 0) {
					$desc	= "<span class='text-success'>"+accounting.formatMoney($saldo, options)+"</span>";
				}else{
					$desc	= "<strong>(&nbsp;<span class='text-danger'>"+accounting.formatMoney($saldo, options)+"</span>&nbsp;)</strong>";
				}
				
				$('#lbInfoSaldoContaDestID').html($desc);
				$('#divInfoSaldoContaDestID').removeClass('hidden');
		    },
			dataType: 'json'
		});
	}
}


function atualizaInfoCategoriaTransfCad() {
	var $desc	= $("#codCategoriaID option:selected").text();
	if ($desc)	{
		$('#lbInfoCategoriaID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoCategoriaID').removeClass('hidden');
	}
}

function atualizaInfoCentroCustoTransfCad() {
	var $desc	= $("#codCentroCustoID option:selected").text();
	if ($desc)	{
		$('#lbInfoCentroCustoID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoCentroCustoID').removeClass('hidden');
	}
}

function atualizaInfoFornecTransfCad($desc) {
	if ($desc)	{
		$('#lbInfoPessoaID').html($desc);
		$('#divInfoConfID').removeClass('hidden');
		$('#divInfoPessoaID').removeClass('hidden');
	}
}

</script>