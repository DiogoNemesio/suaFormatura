<form id="zgFormGerID" class="form-horizontal">
<div class="modal-dialog">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h4 class=""><i class="fa fa-folder blue"></i>%TITULO%</h4>
		</div>
		<div class="modal-body" style="overflow-y: scroll; height: 320px;">
			<input type="hidden" id='codTipoID' name="codTipo" value="%COD_TIPO%">
			<div>
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
					    	<label class="col-sm-8 control-label " for="gerIdentID">Identificação</label>
			    			<div class="col-sm-4">
			   					<input tabindex="1" onchange="calcNumgerIdent();" class="col-sm-12" id="gerIdentID" type="text" name="gerIdent" maxlength="10" value="%IDENT%" required autocomplete="off">	
			    			</div>
			    		</div>
			    	</div>
			    	<div class="col-sm-6">
			    		<label>N&#186; de Dispositivos: </label>
			    		<label id='lblNumDispID'></label>
			    	</div>
				</div>		   
		    	<div class="row" id="divGerMsgID">
				</div>
		    </div>
		</div>
		<div class="modal-footer">
			<button type="button" onclick="return gerCheckFormDisp();" class="btn btn-primary" id="btnGeracaoID" disabled>Gerar</button>
			<button type="button" data-dismiss="modal" class="btn">Fechar</button>
		</div>
	</div>
</div>
</form>


<script type="text/javascript" charset="%CHARSET%">

function gerCheckFormDisp() {
	calcNumgerIdent();
	$('#zgFormGerID').submit();
	
}

$('#zgFormGerID').submit(function() {
	$.ajax({
		type:	"POST", 
		url:	"%DP%",
		data:	$('#zgFormGerID').serialize(),
	}).done(function( data, textStatus, jqXHR) {
		if (checaRetornoOK(data) == true) {
			zgMostraMsg('divGerMsgID',zgGetMsgRetorno(data));
		}else{
			zgMostraErro('divGerMsgID',zgGetMsgRetorno(data));
		}
		
		$('#zgDivModalID').on('hidden.bs.modal', function () {
			zgLoadUrl('%URL_VOLTAR%');
			$('#zgDivModalID').off('hidden.bs.modal');
		});

	}).fail(function( jqXHR, textStatus, errorThrown) {
		zgMostraErro('divPastaMsgID',errorThrown);
	});
	return false; 
});

$("input,textarea").jqBootstrapValidation({
	preventSubmit: true
});

$('textarea[class*=autosize]').autosize({append: "\n"});
$('textarea.limited').inputlimiter({
	remText: 'Restando: %n character%s ...',
	limitText: 'Max: %n.'
});

calcNumgerIdent();

function calcNumgerIdent() {
	var vNumDisp,vTipo,vDisp;
	
	vTipo	= $('#codTipoID').val();
	vDisp	= $('#gerIdentID').val();
	
	if (vDisp == '') {
		$('#lblNumDispID').html('');
		$("#btnGeracaoID").attr("disabled", "disabled");
		return false;
	} 
	
	vNumDisp  = calcNumGerBlocoDisp(vDisp);
	
	$("#btnGeracaoID").removeAttr("disabled");
	$('#lblNumDispID').html(vNumDisp);

}


function calcNumGerBlocoDisp(pStr) {

	
	if (pStr.indexOf("-") < 0) {
		if (isNumeric(pStr) == false) {
			return -1;
		}else{
			return 1;
		}
		
	}else{
		var aTemp = pStr.split("-");
		
		if (aTemp.length != 2) {
			return -1;
		}else{
			var vIni = parseInt(aTemp[0]);
			var vFim = parseInt(aTemp[1]);
			
			if (vIni > vFim) {
				return -1;
			}else{
				if (isNumeric(vIni) == false || vIni < 0) {
					return -1;
				}
				if (isNumeric(vFim) == false || vFim < 0) {
					return -1;
				}
				
				var vNum = ((vFim - vIni) + 1);
				return vNum;
			}
		}
	}
	
}


</script>
